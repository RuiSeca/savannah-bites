{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rui Seca\\\\savannah-bites\\\\frontend\\\\src\\\\components\\\\PaymentPage\\\\index.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useState, useMemo } from \"react\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { PaymentElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { useCart } from \"../../context/CartContext\";\nimport ProgressSteps from \"../ProgressSteps\";\nimport { paymentAPI } from \"../../config/api\";\nimport \"./styles.css\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\nconst DELIVERY_FEE = 2.5;\n\n// Helper functions\nconst validateCartItem = item => {\n  if (!item) throw new Error(\"Invalid cart item\");\n  const price = Number(item.selectedPrice || item.price);\n  const quantity = Number(item.quantity);\n  if (isNaN(price) || price <= 0) {\n    throw new Error(`Invalid price for item: ${item.name}`);\n  }\n  if (!Number.isInteger(quantity) || quantity <= 0) {\n    throw new Error(`Invalid quantity for item: ${item.name}`);\n  }\n  return {\n    price,\n    quantity\n  };\n};\nconst validateCartAndCalculateTotals = cart => {\n  if (!Array.isArray(cart) || cart.length === 0) {\n    throw new Error(\"Cart is empty or invalid\");\n  }\n  const itemTotals = cart.map(item => {\n    const {\n      price,\n      quantity\n    } = validateCartItem(item);\n    return price * quantity;\n  });\n  const subtotal = Number(itemTotals.reduce((sum, total) => sum + total, 0).toFixed(2));\n  const total = Number((subtotal + DELIVERY_FEE).toFixed(2));\n  const amountInCents = Math.round(total * 100);\n  return {\n    subtotal,\n    deliveryFee: DELIVERY_FEE,\n    total,\n    amountInCents\n  };\n};\n\n// Transform order data to match API expectations\nconst transformOrderData = (paymentIntentId, checkoutData) => {\n  // Create delivery time Date object from the 24-hour format time\n  const deliveryTime = new Date();\n  const [hours, minutes] = checkoutData.customerInfo.deliveryTime.split(\":\");\n  deliveryTime.setHours(parseInt(hours, 10), parseInt(minutes, 10), 0, 0);\n\n  // If time has passed for today, set it for tomorrow\n  if (deliveryTime <= new Date()) {\n    deliveryTime.setDate(deliveryTime.getDate() + 1);\n  }\n  const transformedData = {\n    paymentIntentId,\n    orderDetails: checkoutData.items.map(item => ({\n      item: item.id || item._id,\n      // Handle both id formats\n      name: item.name,\n      quantity: parseInt(item.quantity, 10),\n      price: Number(item.price || item.selectedPrice),\n      size: item.size || \"regular\",\n      modifiers: []\n    })),\n    customer: {\n      name: checkoutData.customerInfo.name,\n      email: checkoutData.customerInfo.email.toLowerCase(),\n      phone: checkoutData.customerInfo.phone.replace(/\\s+/g, \"\")\n    },\n    address: {\n      street: checkoutData.customerInfo.address,\n      city: checkoutData.customerInfo.city,\n      postcode: checkoutData.customerInfo.postcode\n    },\n    amount: {\n      subtotal: Number(checkoutData.subtotal),\n      deliveryFee: Number(checkoutData.deliveryFee),\n      total: Number((checkoutData.subtotal + checkoutData.deliveryFee).toFixed(2)),\n      discount: 0\n    },\n    deliveryTime: {\n      requested: deliveryTime\n    },\n    specialInstructions: checkoutData.customerInfo.specialInstructions || \"\",\n    paymentDetails: {\n      paymentIntentId,\n      method: \"card\",\n      status: \"succeeded\"\n    },\n    orderStatus: {\n      current: \"pending\",\n      history: [{\n        status: \"pending\",\n        timestamp: new Date(),\n        note: \"Order placed\"\n      }]\n    }\n  };\n  console.log(\"Transformed order data:\", JSON.stringify(transformedData, null, 2));\n  return transformedData;\n};\n\n// Helper function to validate the transformed data\nconst validateTransformedData = data => {\n  const requiredFields = [\"paymentIntentId\", \"orderDetails\", \"customer\", \"address\", \"amount\", \"deliveryTime\", \"paymentDetails\", \"orderStatus\"];\n  const missingFields = requiredFields.filter(field => !data[field]);\n  if (missingFields.length > 0) {\n    throw new Error(`Missing required fields: ${missingFields.join(\", \")}`);\n  }\n  if (!Array.isArray(data.orderDetails) || data.orderDetails.length === 0) {\n    throw new Error(\"Order must contain at least one item\");\n  }\n  return true;\n};\nfunction CheckoutForm({\n  orderDetails,\n  clientSecret\n}) {\n  _s();\n  const stripe = useStripe();\n  const elements = useElements();\n  const navigate = useNavigate();\n  const {\n    cart,\n    clearCart\n  } = useCart();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState(null);\n\n  // Calculate totals once and memoize the result\n  const totals = useMemo(() => validateCartAndCalculateTotals(cart), [cart]);\n  const handleSubmit = async event => {\n    event.preventDefault();\n    if (!stripe || !elements || isProcessing || !clientSecret) {\n      return;\n    }\n    try {\n      setIsProcessing(true);\n      setError(null);\n\n      // Submit the payment form\n      const {\n        error: submitError\n      } = await elements.submit();\n      if (submitError) {\n        throw new Error(`Payment submission failed: ${submitError.message}`);\n      }\n\n      // Confirm payment\n      const {\n        error: paymentError,\n        paymentIntent\n      } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: `${window.location.origin}/confirmation`,\n          payment_method_data: {\n            billing_details: {\n              name: orderDetails.customerInfo.name,\n              email: orderDetails.customerInfo.email,\n              phone: orderDetails.customerInfo.phone,\n              address: {\n                line1: orderDetails.customerInfo.address,\n                city: orderDetails.customerInfo.city,\n                postal_code: orderDetails.customerInfo.postcode,\n                country: \"GB\"\n              }\n            }\n          }\n        },\n        redirect: \"if_required\"\n      });\n      if (paymentError) {\n        throw new Error(paymentError.message || \"Payment failed\");\n      }\n      if (paymentIntent.status === \"succeeded\") {\n        try {\n          console.log(\"Payment succeeded, creating order...\");\n\n          // Transform and validate the order data\n          const orderData = transformOrderData(paymentIntent.id, orderDetails);\n          validateTransformedData(orderData);\n          console.log(\"Sending order data to API:\", JSON.stringify(orderData, null, 2));\n          const {\n            orderId\n          } = await paymentAPI.createOrder(orderData);\n          console.log(\"Order created successfully:\", orderId);\n          clearCart();\n\n          // Store order information\n          sessionStorage.setItem(\"orderId\", orderId);\n          sessionStorage.setItem(\"paymentIntentId\", paymentIntent.id);\n\n          // Navigate to confirmation\n          navigate(\"/confirmation\", {\n            state: {\n              orderId,\n              paymentIntentId: paymentIntent.id\n            },\n            replace: true\n          });\n        } catch (orderError) {\n          console.error(\"Order creation error:\", orderError);\n          throw new Error(`Payment successful but order creation failed: ${orderError.message}`);\n        }\n      }\n    } catch (error) {\n      console.error(\"Payment processing error:\", error);\n      setError(error.message || \"Payment processing failed\");\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-container\",\n    children: [/*#__PURE__*/_jsxDEV(ProgressSteps, {\n      currentStep: 2\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"payment-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"back-button\",\n        onClick: () => navigate(-1),\n        children: \"\\u2190 Back\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Secure Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"order-summary\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Order Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"items-list\",\n          children: cart.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"order-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"item-name\",\n                children: item.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 272,\n                columnNumber: 19\n              }, this), item.size && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"item-size\",\n                children: [\"(\", item.size, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 274,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 271,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-price\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"quantity\",\n                children: [\"x\", item.quantity]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 278,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"price\",\n                children: [\"\\xA3\", ((item.selectedPrice || item.price) * item.quantity).toFixed(2)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 277,\n              columnNumber: 17\n            }, this)]\n          }, `${item.id}-${item.size || \"regular\"}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"price-breakdown\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Subtotal\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", totals.subtotal.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Delivery Fee\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 296,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", totals.deliveryFee.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row total\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Total to Pay\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", totals.total.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 301,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"delivery-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Delivery Details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 11\n        }, this), (orderDetails === null || orderDetails === void 0 ? void 0 : orderDetails.customerInfo) && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Name:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 310,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Phone:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.phone\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 316,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Address:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.address\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 318,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"City:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 323,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.city\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 324,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Postcode:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 327,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.postcode\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 328,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Delivery Time:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 331,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.deliveryTime\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 332,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 330,\n            columnNumber: 15\n          }, this), orderDetails.customerInfo.specialInstructions && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"special-instructions\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"Special Instructions:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 336,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: orderDetails.customerInfo.specialInstructions\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"payment-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"payment-element-container\",\n        children: /*#__PURE__*/_jsxDEV(PaymentElement, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 347,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 346,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        role: \"alert\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"payment-button\",\n        disabled: !stripe || isProcessing,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-content\",\n          children: isProcessing ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"spinner\",\n              role: \"status\",\n              \"aria-label\": \"Processing payment\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 364,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Processing...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Pay \\xA3\", totals.total.toFixed(2)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"security-info\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"\\uD83D\\uDD12 All payments are secure and encrypted\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 378,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 254,\n    columnNumber: 5\n  }, this);\n}\n_s(CheckoutForm, \"+ZXg9CdR37RR6N3HBf2a1/w2LaU=\", false, function () {\n  return [useStripe, useElements, useNavigate, useCart];\n});\n_c = CheckoutForm;\nfunction PaymentPage() {\n  _s2();\n  var _location$state;\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const location = useLocation();\n  const navigate = useNavigate();\n  const {\n    cart\n  } = useCart();\n  const orderDetails = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.orderDetails;\n  useEffect(() => {\n    const initializePayment = async () => {\n      try {\n        if (!(orderDetails !== null && orderDetails !== void 0 && orderDetails.customerInfo)) {\n          throw new Error(\"Please complete your delivery information\");\n        }\n        if (!(cart !== null && cart !== void 0 && cart.length)) {\n          throw new Error(\"Your cart is empty\");\n        }\n        const {\n          amountInCents\n        } = validateCartAndCalculateTotals(cart);\n        console.log(\"Creating payment intent:\", {\n          amount: amountInCents,\n          customer: orderDetails.customerInfo.name\n        });\n        const response = await paymentAPI.createPaymentIntent({\n          amount: amountInCents,\n          currency: \"gbp\",\n          metadata: {\n            customerName: orderDetails.customerInfo.name,\n            customerEmail: orderDetails.customerInfo.email,\n            integration_check: \"accept_a_payment\"\n          }\n        });\n        console.log(\"Payment intent response:\", {\n          hasClientSecret: !!response.clientSecret,\n          hasId: !!response.id\n        });\n        if (!response.clientSecret) {\n          throw new Error(\"Failed to initialize payment\");\n        }\n        setClientSecret(response.clientSecret);\n      } catch (error) {\n        console.error(\"Payment initialization failed:\", error);\n        setError(error.message);\n        setTimeout(() => {\n          navigate(\"/checkout\", {\n            state: {\n              error: error.message\n            }\n          });\n        }, 100);\n      } finally {\n        setLoading(false);\n      }\n    };\n    if (orderDetails && cart !== null && cart !== void 0 && cart.length) {\n      initializePayment();\n    } else {\n      setLoading(false);\n      setError(\"Missing order details or empty cart\");\n      setTimeout(() => navigate(\"/checkout\"), 100);\n    }\n  }, [cart, orderDetails, navigate]);\n\n  // Loading state\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      role: \"status\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 459,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Setting up payment...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 458,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Error state\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-container\",\n      role: \"alert\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Payment Setup Failed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate(\"/checkout\"),\n        className: \"return-button\",\n        children: \"Return to Checkout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 468,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Success state\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-page\",\n    children: clientSecret && /*#__PURE__*/_jsxDEV(Elements, {\n      stripe: stripePromise,\n      options: {\n        clientSecret,\n        appearance: {\n          theme: \"stripe\",\n          variables: {\n            colorPrimary: \"#0a5c66\",\n            colorBackground: \"#ffffff\",\n            colorText: \"#30313d\"\n          }\n        }\n      },\n      children: /*#__PURE__*/_jsxDEV(CheckoutForm, {\n        orderDetails: orderDetails,\n        clientSecret: clientSecret\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 496,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 482,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 480,\n    columnNumber: 5\n  }, this);\n}\n_s2(PaymentPage, \"Eoq4yd5UtjLFsd+qbYkTOG9Jok8=\", false, function () {\n  return [useLocation, useNavigate, useCart];\n});\n_c2 = PaymentPage;\nexport default PaymentPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"CheckoutForm\");\n$RefreshReg$(_c2, \"PaymentPage\");","map":{"version":3,"names":["React","useEffect","useState","useMemo","Elements","PaymentElement","useStripe","useElements","loadStripe","useNavigate","useLocation","useCart","ProgressSteps","paymentAPI","jsxDEV","_jsxDEV","Fragment","_Fragment","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","DELIVERY_FEE","validateCartItem","item","Error","price","Number","selectedPrice","quantity","isNaN","name","isInteger","validateCartAndCalculateTotals","cart","Array","isArray","length","itemTotals","map","subtotal","reduce","sum","total","toFixed","amountInCents","Math","round","deliveryFee","transformOrderData","paymentIntentId","checkoutData","deliveryTime","Date","hours","minutes","customerInfo","split","setHours","parseInt","setDate","getDate","transformedData","orderDetails","items","id","_id","size","modifiers","customer","email","toLowerCase","phone","replace","address","street","city","postcode","amount","discount","requested","specialInstructions","paymentDetails","method","status","orderStatus","current","history","timestamp","note","console","log","JSON","stringify","validateTransformedData","data","requiredFields","missingFields","filter","field","join","CheckoutForm","clientSecret","_s","stripe","elements","navigate","clearCart","isProcessing","setIsProcessing","error","setError","totals","handleSubmit","event","preventDefault","submitError","submit","message","paymentError","paymentIntent","confirmPayment","confirmParams","return_url","window","location","origin","payment_method_data","billing_details","line1","postal_code","country","redirect","orderData","orderId","createOrder","sessionStorage","setItem","state","orderError","className","children","currentStep","fileName","_jsxFileName","lineNumber","columnNumber","onClick","onSubmit","role","type","disabled","_c","PaymentPage","_s2","_location$state","setClientSecret","loading","setLoading","initializePayment","response","createPaymentIntent","currency","metadata","customerName","customerEmail","integration_check","hasClientSecret","hasId","setTimeout","options","appearance","theme","variables","colorPrimary","colorBackground","colorText","_c2","$RefreshReg$"],"sources":["C:/Users/Rui Seca/savannah-bites/frontend/src/components/PaymentPage/index.jsx"],"sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { Elements } from \"@stripe/react-stripe-js\";\r\nimport {\r\n  PaymentElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport { useCart } from \"../../context/CartContext\";\r\nimport ProgressSteps from \"../ProgressSteps\";\r\nimport { paymentAPI } from \"../../config/api\";\r\nimport \"./styles.css\";\r\n\r\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\r\n\r\nconst DELIVERY_FEE = 2.5;\r\n\r\n// Helper functions\r\nconst validateCartItem = (item) => {\r\n  if (!item) throw new Error(\"Invalid cart item\");\r\n\r\n  const price = Number(item.selectedPrice || item.price);\r\n  const quantity = Number(item.quantity);\r\n\r\n  if (isNaN(price) || price <= 0) {\r\n    throw new Error(`Invalid price for item: ${item.name}`);\r\n  }\r\n  if (!Number.isInteger(quantity) || quantity <= 0) {\r\n    throw new Error(`Invalid quantity for item: ${item.name}`);\r\n  }\r\n\r\n  return { price, quantity };\r\n};\r\n\r\nconst validateCartAndCalculateTotals = (cart) => {\r\n  if (!Array.isArray(cart) || cart.length === 0) {\r\n    throw new Error(\"Cart is empty or invalid\");\r\n  }\r\n\r\n  const itemTotals = cart.map((item) => {\r\n    const { price, quantity } = validateCartItem(item);\r\n    return price * quantity;\r\n  });\r\n\r\n  const subtotal = Number(\r\n    itemTotals.reduce((sum, total) => sum + total, 0).toFixed(2)\r\n  );\r\n  const total = Number((subtotal + DELIVERY_FEE).toFixed(2));\r\n  const amountInCents = Math.round(total * 100);\r\n\r\n  return {\r\n    subtotal,\r\n    deliveryFee: DELIVERY_FEE,\r\n    total,\r\n    amountInCents,\r\n  };\r\n};\r\n\r\n// Transform order data to match API expectations\r\nconst transformOrderData = (paymentIntentId, checkoutData) => {\r\n  // Create delivery time Date object from the 24-hour format time\r\n  const deliveryTime = new Date();\r\n  const [hours, minutes] = checkoutData.customerInfo.deliveryTime.split(\":\");\r\n  deliveryTime.setHours(parseInt(hours, 10), parseInt(minutes, 10), 0, 0);\r\n\r\n  // If time has passed for today, set it for tomorrow\r\n  if (deliveryTime <= new Date()) {\r\n    deliveryTime.setDate(deliveryTime.getDate() + 1);\r\n  }\r\n\r\n  const transformedData = {\r\n    paymentIntentId,\r\n    orderDetails: checkoutData.items.map((item) => ({\r\n      item: item.id || item._id, // Handle both id formats\r\n      name: item.name,\r\n      quantity: parseInt(item.quantity, 10),\r\n      price: Number(item.price || item.selectedPrice),\r\n      size: item.size || \"regular\",\r\n      modifiers: [],\r\n    })),\r\n    customer: {\r\n      name: checkoutData.customerInfo.name,\r\n      email: checkoutData.customerInfo.email.toLowerCase(),\r\n      phone: checkoutData.customerInfo.phone.replace(/\\s+/g, \"\"),\r\n    },\r\n    address: {\r\n      street: checkoutData.customerInfo.address,\r\n      city: checkoutData.customerInfo.city,\r\n      postcode: checkoutData.customerInfo.postcode,\r\n    },\r\n    amount: {\r\n      subtotal: Number(checkoutData.subtotal),\r\n      deliveryFee: Number(checkoutData.deliveryFee),\r\n      total: Number(\r\n        (checkoutData.subtotal + checkoutData.deliveryFee).toFixed(2)\r\n      ),\r\n      discount: 0,\r\n    },\r\n    deliveryTime: {\r\n      requested: deliveryTime,\r\n    },\r\n    specialInstructions: checkoutData.customerInfo.specialInstructions || \"\",\r\n    paymentDetails: {\r\n      paymentIntentId,\r\n      method: \"card\",\r\n      status: \"succeeded\",\r\n    },\r\n    orderStatus: {\r\n      current: \"pending\",\r\n      history: [\r\n        {\r\n          status: \"pending\",\r\n          timestamp: new Date(),\r\n          note: \"Order placed\",\r\n        },\r\n      ],\r\n    },\r\n  };\r\n\r\n  console.log(\r\n    \"Transformed order data:\",\r\n    JSON.stringify(transformedData, null, 2)\r\n  );\r\n  return transformedData;\r\n};\r\n\r\n// Helper function to validate the transformed data\r\nconst validateTransformedData = (data) => {\r\n  const requiredFields = [\r\n    \"paymentIntentId\",\r\n    \"orderDetails\",\r\n    \"customer\",\r\n    \"address\",\r\n    \"amount\",\r\n    \"deliveryTime\",\r\n    \"paymentDetails\",\r\n    \"orderStatus\",\r\n  ];\r\n\r\n  const missingFields = requiredFields.filter((field) => !data[field]);\r\n  if (missingFields.length > 0) {\r\n    throw new Error(`Missing required fields: ${missingFields.join(\", \")}`);\r\n  }\r\n\r\n  if (!Array.isArray(data.orderDetails) || data.orderDetails.length === 0) {\r\n    throw new Error(\"Order must contain at least one item\");\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nfunction CheckoutForm({ orderDetails, clientSecret }) {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const navigate = useNavigate();\r\n  const { cart, clearCart } = useCart();\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Calculate totals once and memoize the result\r\n  const totals = useMemo(() => validateCartAndCalculateTotals(cart), [cart]);\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n\r\n    if (!stripe || !elements || isProcessing || !clientSecret) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsProcessing(true);\r\n      setError(null);\r\n\r\n      // Submit the payment form\r\n      const { error: submitError } = await elements.submit();\r\n      if (submitError) {\r\n        throw new Error(`Payment submission failed: ${submitError.message}`);\r\n      }\r\n\r\n      // Confirm payment\r\n      const { error: paymentError, paymentIntent } =\r\n        await stripe.confirmPayment({\r\n          elements,\r\n          confirmParams: {\r\n            return_url: `${window.location.origin}/confirmation`,\r\n            payment_method_data: {\r\n              billing_details: {\r\n                name: orderDetails.customerInfo.name,\r\n                email: orderDetails.customerInfo.email,\r\n                phone: orderDetails.customerInfo.phone,\r\n                address: {\r\n                  line1: orderDetails.customerInfo.address,\r\n                  city: orderDetails.customerInfo.city,\r\n                  postal_code: orderDetails.customerInfo.postcode,\r\n                  country: \"GB\",\r\n                },\r\n              },\r\n            },\r\n          },\r\n          redirect: \"if_required\",\r\n        });\r\n\r\n      if (paymentError) {\r\n        throw new Error(paymentError.message || \"Payment failed\");\r\n      }\r\n\r\n      if (paymentIntent.status === \"succeeded\") {\r\n        try {\r\n          console.log(\"Payment succeeded, creating order...\");\r\n\r\n          // Transform and validate the order data\r\n          const orderData = transformOrderData(paymentIntent.id, orderDetails);\r\n          validateTransformedData(orderData);\r\n\r\n          console.log(\r\n            \"Sending order data to API:\",\r\n            JSON.stringify(orderData, null, 2)\r\n          );\r\n\r\n          const { orderId } = await paymentAPI.createOrder(orderData);\r\n          console.log(\"Order created successfully:\", orderId);\r\n\r\n          clearCart();\r\n\r\n          // Store order information\r\n          sessionStorage.setItem(\"orderId\", orderId);\r\n          sessionStorage.setItem(\"paymentIntentId\", paymentIntent.id);\r\n\r\n          // Navigate to confirmation\r\n          navigate(\"/confirmation\", {\r\n            state: {\r\n              orderId,\r\n              paymentIntentId: paymentIntent.id,\r\n            },\r\n            replace: true,\r\n          });\r\n        } catch (orderError) {\r\n          console.error(\"Order creation error:\", orderError);\r\n          throw new Error(\r\n            `Payment successful but order creation failed: ${orderError.message}`\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Payment processing error:\", error);\r\n      setError(error.message || \"Payment processing failed\");\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"payment-container\">\r\n      <ProgressSteps currentStep={2} />\r\n\r\n      <div className=\"payment-header\">\r\n        <button className=\"back-button\" onClick={() => navigate(-1)}>\r\n          ← Back\r\n        </button>\r\n        <h1>Secure Payment</h1>\r\n\r\n        <div className=\"order-summary\">\r\n          <h2>Order Summary</h2>\r\n          <div className=\"items-list\">\r\n            {cart.map((item) => (\r\n              <div\r\n                key={`${item.id}-${item.size || \"regular\"}`}\r\n                className=\"order-item\"\r\n              >\r\n                <div className=\"item-info\">\r\n                  <span className=\"item-name\">{item.name}</span>\r\n                  {item.size && (\r\n                    <span className=\"item-size\">({item.size})</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"item-price\">\r\n                  <span className=\"quantity\">x{item.quantity}</span>\r\n                  <span className=\"price\">\r\n                    £\r\n                    {(\r\n                      (item.selectedPrice || item.price) * item.quantity\r\n                    ).toFixed(2)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"price-breakdown\">\r\n            <div className=\"price-row\">\r\n              <span>Subtotal</span>\r\n              <span>£{totals.subtotal.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"price-row\">\r\n              <span>Delivery Fee</span>\r\n              <span>£{totals.deliveryFee.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"price-row total\">\r\n              <span>Total to Pay</span>\r\n              <span>£{totals.total.toFixed(2)}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"delivery-info\">\r\n          <h3>Delivery Details</h3>\r\n          {orderDetails?.customerInfo && (\r\n            <>\r\n              <div className=\"info-row\">\r\n                <span>Name:</span>\r\n                <span>{orderDetails.customerInfo.name}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>Phone:</span>\r\n                <span>{orderDetails.customerInfo.phone}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>Address:</span>\r\n                <span>{orderDetails.customerInfo.address}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>City:</span>\r\n                <span>{orderDetails.customerInfo.city}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>Postcode:</span>\r\n                <span>{orderDetails.customerInfo.postcode}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>Delivery Time:</span>\r\n                <span>{orderDetails.customerInfo.deliveryTime}</span>\r\n              </div>\r\n              {orderDetails.customerInfo.specialInstructions && (\r\n                <div className=\"special-instructions\">\r\n                  <h4>Special Instructions:</h4>\r\n                  <p>{orderDetails.customerInfo.specialInstructions}</p>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"payment-form\">\r\n        <div className=\"payment-element-container\">\r\n          <PaymentElement />\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"error-message\" role=\"alert\">\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <button\r\n          type=\"submit\"\r\n          className=\"payment-button\"\r\n          disabled={!stripe || isProcessing}\r\n        >\r\n          <div className=\"button-content\">\r\n            {isProcessing ? (\r\n              <>\r\n                <div\r\n                  className=\"spinner\"\r\n                  role=\"status\"\r\n                  aria-label=\"Processing payment\"\r\n                />\r\n                <span>Processing...</span>\r\n              </>\r\n            ) : (\r\n              <span>Pay £{totals.total.toFixed(2)}</span>\r\n            )}\r\n          </div>\r\n        </button>\r\n      </form>\r\n\r\n      <div className=\"security-info\">\r\n        <p>🔒 All payments are secure and encrypted</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PaymentPage() {\r\n  const [clientSecret, setClientSecret] = useState(\"\");\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { cart } = useCart();\r\n\r\n  const orderDetails = location.state?.orderDetails;\r\n\r\n  useEffect(() => {\r\n    const initializePayment = async () => {\r\n      try {\r\n        if (!orderDetails?.customerInfo) {\r\n          throw new Error(\"Please complete your delivery information\");\r\n        }\r\n\r\n        if (!cart?.length) {\r\n          throw new Error(\"Your cart is empty\");\r\n        }\r\n\r\n        const { amountInCents } = validateCartAndCalculateTotals(cart);\r\n\r\n        console.log(\"Creating payment intent:\", {\r\n          amount: amountInCents,\r\n          customer: orderDetails.customerInfo.name,\r\n        });\r\n\r\n        const response = await paymentAPI.createPaymentIntent({\r\n          amount: amountInCents,\r\n          currency: \"gbp\",\r\n          metadata: {\r\n            customerName: orderDetails.customerInfo.name,\r\n            customerEmail: orderDetails.customerInfo.email,\r\n            integration_check: \"accept_a_payment\",\r\n          },\r\n        });\r\n\r\n        console.log(\"Payment intent response:\", {\r\n          hasClientSecret: !!response.clientSecret,\r\n          hasId: !!response.id,\r\n        });\r\n\r\n        if (!response.clientSecret) {\r\n          throw new Error(\"Failed to initialize payment\");\r\n        }\r\n\r\n        setClientSecret(response.clientSecret);\r\n      } catch (error) {\r\n        console.error(\"Payment initialization failed:\", error);\r\n        setError(error.message);\r\n        setTimeout(() => {\r\n          navigate(\"/checkout\", {\r\n            state: { error: error.message },\r\n          });\r\n        }, 100);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    if (orderDetails && cart?.length) {\r\n      initializePayment();\r\n    } else {\r\n      setLoading(false);\r\n      setError(\"Missing order details or empty cart\");\r\n      setTimeout(() => navigate(\"/checkout\"), 100);\r\n    }\r\n  }, [cart, orderDetails, navigate]);\r\n\r\n  // Loading state\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading-container\" role=\"status\">\r\n        <div className=\"spinner\" />\r\n        <p>Setting up payment...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Error state\r\n  if (error) {\r\n    return (\r\n      <div className=\"error-container\" role=\"alert\">\r\n        <h2>Payment Setup Failed</h2>\r\n        <p>{error}</p>\r\n        <button onClick={() => navigate(\"/checkout\")} className=\"return-button\">\r\n          Return to Checkout\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Success state\r\n  return (\r\n    <div className=\"payment-page\">\r\n      {clientSecret && (\r\n        <Elements\r\n          stripe={stripePromise}\r\n          options={{\r\n            clientSecret,\r\n            appearance: {\r\n              theme: \"stripe\",\r\n              variables: {\r\n                colorPrimary: \"#0a5c66\",\r\n                colorBackground: \"#ffffff\",\r\n                colorText: \"#30313d\",\r\n              },\r\n            },\r\n          }}\r\n        >\r\n          <CheckoutForm\r\n            orderDetails={orderDetails}\r\n            clientSecret={clientSecret}\r\n          />\r\n        </Elements>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default PaymentPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}