{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rui Seca\\\\savannah-bites\\\\frontend\\\\src\\\\components\\\\PaymentPage\\\\index.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { PaymentElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { useCart } from \"../../context/CartContext\";\nimport ProgressSteps from \"../ProgressSteps/index.jsx\";\nimport \"./styles.css\";\n\n// Stripe initialization\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\n\n// API configuration\nconst apiUrl = process.env.NODE_ENV === \"development\" ? process.env.REACT_APP_NGROK_URL || process.env.REACT_APP_API_BASE_URL : process.env.REACT_APP_API_BASE_URL;\n\n// Create axios instance with proper URL construction\nconst api = axios.create({\n  baseURL: apiUrl.endsWith(\"/api\") ? apiUrl : `${apiUrl}/api`,\n  withCredentials: true,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\nconst DELIVERY_FEE = 2.5;\nfunction CheckoutForm() {\n  _s();\n  var _location$state, _orderDetails$custome;\n  const stripe = useStripe();\n  const elements = useElements();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    cart,\n    clearCart\n  } = useCart();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState(null);\n  const orderDetails = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.orderDetails;\n\n  // Validate order details\n  useEffect(() => {\n    if (!(orderDetails !== null && orderDetails !== void 0 && orderDetails.customerInfo) || !cart.length) {\n      console.log(\"Missing order details or empty cart, redirecting to checkout\");\n      navigate(\"/checkout\");\n    }\n  }, [orderDetails, cart, navigate]);\n  const calculateTotals = () => {\n    const subtotal = cart.reduce((sum, item) => sum + (item.selectedPrice || item.price) * item.quantity, 0);\n    return {\n      subtotal,\n      deliveryFee: DELIVERY_FEE,\n      total: subtotal + DELIVERY_FEE\n    };\n  };\n  const createOrder = async paymentIntent => {\n    try {\n      console.log(\"Creating order...\");\n      const {\n        subtotal,\n        deliveryFee,\n        total\n      } = calculateTotals();\n      const orderData = {\n        paymentIntentId: paymentIntent.id,\n        orderDetails: {\n          items: cart.map(item => ({\n            id: item._id || item.id,\n            name: item.name,\n            quantity: item.quantity,\n            price: item.selectedPrice || item.price,\n            size: item.size || \"regular\"\n          })),\n          subtotal,\n          deliveryFee,\n          totalAmount: total,\n          customerInfo: orderDetails.customerInfo\n        }\n      };\n      console.log(\"Sending order data:\", orderData);\n      const response = await api.post(\"/orders\", orderData);\n      console.log(\"Order created successfully:\", response.data);\n      return response.data;\n    } catch (error) {\n      var _error$response, _error$response2, _error$response3, _error$response3$data;\n      console.error(\"Order creation failed:\", error);\n      console.error(\"Error details:\", {\n        message: error.message,\n        response: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data,\n        status: (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status\n      });\n      throw new Error(\"Failed to create order: \" + (((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || error.message));\n    }\n  };\n  const handleSubmit = async event => {\n    event.preventDefault();\n    if (!stripe || !elements || isProcessing) {\n      return;\n    }\n    try {\n      setIsProcessing(true);\n      setError(null);\n      console.log(\"Submitting payment form...\");\n      const {\n        error: submitError\n      } = await elements.submit();\n      if (submitError) {\n        throw submitError;\n      }\n      console.log(\"Confirming payment...\");\n      const {\n        error: paymentError,\n        paymentIntent\n      } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: `${window.location.origin}/confirmation`,\n          payment_method_data: {\n            billing_details: {\n              name: orderDetails.customerInfo.name,\n              email: orderDetails.customerInfo.email,\n              phone: orderDetails.customerInfo.phone,\n              address: {\n                line1: orderDetails.customerInfo.address,\n                city: orderDetails.customerInfo.city,\n                postal_code: orderDetails.customerInfo.postcode,\n                country: \"GB\"\n              }\n            }\n          }\n        },\n        redirect: \"if_required\"\n      });\n      if (paymentError) {\n        console.error(\"Payment error:\", paymentError);\n        throw paymentError;\n      }\n      if (paymentIntent.status === \"succeeded\") {\n        console.log(\"Payment succeeded, creating order...\");\n        const {\n          orderId\n        } = await createOrder(paymentIntent);\n        clearCart();\n        navigate(\"/confirmation\", {\n          state: {\n            orderId,\n            status: \"success\",\n            paymentIntentId: paymentIntent.id\n          },\n          replace: true\n        });\n      }\n    } catch (error) {\n      console.error(\"Payment/Order error:\", error);\n      setError(error.message);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  const {\n    subtotal,\n    total\n  } = calculateTotals();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-container\",\n    children: [/*#__PURE__*/_jsxDEV(ProgressSteps, {\n      currentStep: 2\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"payment-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Secure Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"order-summary\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Order Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"items-list\",\n          children: cart.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"order-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"item-name\",\n                children: item.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 191,\n                columnNumber: 19\n              }, this), item.size && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"item-size\",\n                children: item.size\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 192,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-price\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"quantity\",\n                children: [\"x\", item.quantity]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 195,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"price\",\n                children: [\"\\xA3\", ((item.selectedPrice || item.price) * item.quantity).toFixed(2)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 196,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 194,\n              columnNumber: 17\n            }, this)]\n          }, `${item.id || item._id}-${item.size || \"regular\"}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"price-breakdown\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Subtotal\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 209,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", subtotal.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 210,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Delivery Fee\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 213,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", DELIVERY_FEE.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 214,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row total\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Total to Pay\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", total.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"delivery-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Delivery Details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this), (orderDetails === null || orderDetails === void 0 ? void 0 : orderDetails.customerInfo) && Object.entries(orderDetails.customerInfo).map(([key, value]) => key !== \"email\" && key !== \"specialInstructions\" && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"info-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: [key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, \" $1\"), \":\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: value\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 21\n          }, this)]\n        }, key, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 19\n        }, this)), (orderDetails === null || orderDetails === void 0 ? void 0 : (_orderDetails$custome = orderDetails.customerInfo) === null || _orderDetails$custome === void 0 ? void 0 : _orderDetails$custome.specialInstructions) && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"special-instructions\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Special Instructions:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: orderDetails.customerInfo.specialInstructions\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"payment-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"payment-element-container\",\n        children: /*#__PURE__*/_jsxDEV(PaymentElement, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        role: \"alert\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"payment-button\",\n        disabled: !stripe || isProcessing,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-content\",\n          children: isProcessing ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"spinner\",\n              role: \"status\",\n              \"aria-label\": \"Processing payment\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 268,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Processing...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 273,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Pay \\xA3\", total.toFixed(2)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"security-info\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"\\uD83D\\uDD12 All payments are secure and encrypted\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 177,\n    columnNumber: 5\n  }, this);\n}\n_s(CheckoutForm, \"na5PFFw6chbSUMgTqbnM1WwBVyM=\", false, function () {\n  return [useStripe, useElements, useNavigate, useLocation, useCart];\n});\n_c = CheckoutForm;\nfunction PaymentPage() {\n  _s2();\n  var _location$state2;\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [error, setError] = useState(null);\n  const location = useLocation();\n  const navigate = useNavigate();\n  const {\n    cart\n  } = useCart();\n  const orderDetails = (_location$state2 = location.state) === null || _location$state2 === void 0 ? void 0 : _location$state2.orderDetails;\n  useEffect(() => {\n    if (!orderDetails || !(cart !== null && cart !== void 0 && cart.length)) {\n      console.log(\"Invalid payment page access, redirecting to checkout\");\n      navigate(\"/checkout\");\n      return;\n    }\n    const createPaymentIntent = async () => {\n      try {\n        console.log(\"Creating payment intent...\");\n        console.log(\"API URL:\", api.defaults.baseURL);\n        const response = await api.post(\"/orders/create-payment-intent\", {\n          amount: orderDetails.totalAmount,\n          currency: \"gbp\",\n          metadata: {\n            customerName: orderDetails.customerInfo.name,\n            customerEmail: orderDetails.customerInfo.email\n          }\n        });\n        console.log(\"Payment intent created:\", response.data);\n        setClientSecret(response.data.clientSecret);\n      } catch (error) {\n        var _error$response4, _error$response5, _error$response6, _error$response6$data;\n        console.error(\"Payment setup error:\", error);\n        console.error(\"Error details:\", {\n          message: error.message,\n          response: (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.data,\n          status: (_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.status,\n          config: error.config\n        });\n        setError(((_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : (_error$response6$data = _error$response6.data) === null || _error$response6$data === void 0 ? void 0 : _error$response6$data.message) || \"Failed to setup payment. Please try again.\");\n      }\n    };\n    createPaymentIntent();\n  }, [cart, orderDetails, navigate]);\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-container\",\n      role: \"alert\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Payment Setup Failed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate(\"/checkout\"),\n        className: \"return-button\",\n        children: \"Return to Checkout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 7\n    }, this);\n  }\n  if (!clientSecret) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      role: \"status\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Setting up payment...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 353,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-page\",\n    children: /*#__PURE__*/_jsxDEV(Elements, {\n      stripe: stripePromise,\n      options: {\n        clientSecret,\n        appearance: {\n          theme: \"stripe\",\n          variables: {\n            colorPrimary: \"#0a5c66\",\n            colorBackground: \"#ffffff\",\n            colorText: \"#30313d\"\n          }\n        }\n      },\n      children: /*#__PURE__*/_jsxDEV(CheckoutForm, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 361,\n    columnNumber: 5\n  }, this);\n}\n_s2(PaymentPage, \"aDNKusgezv9q3SH/CUvy39hgiwI=\", false, function () {\n  return [useLocation, useNavigate, useCart];\n});\n_c2 = PaymentPage;\nexport default PaymentPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"CheckoutForm\");\n$RefreshReg$(_c2, \"PaymentPage\");","map":{"version":3,"names":["React","useState","useEffect","axios","Elements","PaymentElement","useStripe","useElements","loadStripe","useNavigate","useLocation","useCart","ProgressSteps","jsxDEV","_jsxDEV","Fragment","_Fragment","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","apiUrl","NODE_ENV","REACT_APP_NGROK_URL","REACT_APP_API_BASE_URL","api","create","baseURL","endsWith","withCredentials","headers","DELIVERY_FEE","CheckoutForm","_s","_location$state","_orderDetails$custome","stripe","elements","navigate","location","cart","clearCart","isProcessing","setIsProcessing","error","setError","orderDetails","state","customerInfo","length","console","log","calculateTotals","subtotal","reduce","sum","item","selectedPrice","price","quantity","deliveryFee","total","createOrder","paymentIntent","orderData","paymentIntentId","id","items","map","_id","name","size","totalAmount","response","post","data","_error$response","_error$response2","_error$response3","_error$response3$data","message","status","Error","handleSubmit","event","preventDefault","submitError","submit","paymentError","confirmPayment","confirmParams","return_url","window","origin","payment_method_data","billing_details","email","phone","address","line1","city","postal_code","postcode","country","redirect","orderId","replace","className","children","currentStep","fileName","_jsxFileName","lineNumber","columnNumber","toFixed","Object","entries","key","value","charAt","toUpperCase","slice","specialInstructions","onSubmit","role","type","disabled","_c","PaymentPage","_s2","_location$state2","clientSecret","setClientSecret","createPaymentIntent","defaults","amount","currency","metadata","customerName","customerEmail","_error$response4","_error$response5","_error$response6","_error$response6$data","config","onClick","options","appearance","theme","variables","colorPrimary","colorBackground","colorText","_c2","$RefreshReg$"],"sources":["C:/Users/Rui Seca/savannah-bites/frontend/src/components/PaymentPage/index.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Elements } from \"@stripe/react-stripe-js\";\r\nimport {\r\n  PaymentElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport { useCart } from \"../../context/CartContext\";\r\nimport ProgressSteps from \"../ProgressSteps/index.jsx\";\r\nimport \"./styles.css\";\r\n\r\n// Stripe initialization\r\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\r\n\r\n// API configuration\r\nconst apiUrl =\r\n  process.env.NODE_ENV === \"development\"\r\n    ? process.env.REACT_APP_NGROK_URL || process.env.REACT_APP_API_BASE_URL\r\n    : process.env.REACT_APP_API_BASE_URL;\r\n\r\n// Create axios instance with proper URL construction\r\nconst api = axios.create({\r\n  baseURL: apiUrl.endsWith(\"/api\") ? apiUrl : `${apiUrl}/api`,\r\n  withCredentials: true,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\nconst DELIVERY_FEE = 2.5;\r\n\r\nfunction CheckoutForm() {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { cart, clearCart } = useCart();\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  const orderDetails = location.state?.orderDetails;\r\n\r\n  // Validate order details\r\n  useEffect(() => {\r\n    if (!orderDetails?.customerInfo || !cart.length) {\r\n      console.log(\r\n        \"Missing order details or empty cart, redirecting to checkout\"\r\n      );\r\n      navigate(\"/checkout\");\r\n    }\r\n  }, [orderDetails, cart, navigate]);\r\n\r\n  const calculateTotals = () => {\r\n    const subtotal = cart.reduce(\r\n      (sum, item) => sum + (item.selectedPrice || item.price) * item.quantity,\r\n      0\r\n    );\r\n    return {\r\n      subtotal,\r\n      deliveryFee: DELIVERY_FEE,\r\n      total: subtotal + DELIVERY_FEE,\r\n    };\r\n  };\r\n\r\n  const createOrder = async (paymentIntent) => {\r\n    try {\r\n      console.log(\"Creating order...\");\r\n      const { subtotal, deliveryFee, total } = calculateTotals();\r\n\r\n      const orderData = {\r\n        paymentIntentId: paymentIntent.id,\r\n        orderDetails: {\r\n          items: cart.map((item) => ({\r\n            id: item._id || item.id,\r\n            name: item.name,\r\n            quantity: item.quantity,\r\n            price: item.selectedPrice || item.price,\r\n            size: item.size || \"regular\",\r\n          })),\r\n          subtotal,\r\n          deliveryFee,\r\n          totalAmount: total,\r\n          customerInfo: orderDetails.customerInfo,\r\n        },\r\n      };\r\n\r\n      console.log(\"Sending order data:\", orderData);\r\n      const response = await api.post(\"/orders\", orderData);\r\n      console.log(\"Order created successfully:\", response.data);\r\n      return response.data;\r\n    } catch (error) {\r\n      console.error(\"Order creation failed:\", error);\r\n      console.error(\"Error details:\", {\r\n        message: error.message,\r\n        response: error.response?.data,\r\n        status: error.response?.status,\r\n      });\r\n      throw new Error(\r\n        \"Failed to create order: \" +\r\n          (error.response?.data?.message || error.message)\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n\r\n    if (!stripe || !elements || isProcessing) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsProcessing(true);\r\n      setError(null);\r\n\r\n      console.log(\"Submitting payment form...\");\r\n      const { error: submitError } = await elements.submit();\r\n      if (submitError) {\r\n        throw submitError;\r\n      }\r\n\r\n      console.log(\"Confirming payment...\");\r\n      const { error: paymentError, paymentIntent } =\r\n        await stripe.confirmPayment({\r\n          elements,\r\n          confirmParams: {\r\n            return_url: `${window.location.origin}/confirmation`,\r\n            payment_method_data: {\r\n              billing_details: {\r\n                name: orderDetails.customerInfo.name,\r\n                email: orderDetails.customerInfo.email,\r\n                phone: orderDetails.customerInfo.phone,\r\n                address: {\r\n                  line1: orderDetails.customerInfo.address,\r\n                  city: orderDetails.customerInfo.city,\r\n                  postal_code: orderDetails.customerInfo.postcode,\r\n                  country: \"GB\",\r\n                },\r\n              },\r\n            },\r\n          },\r\n          redirect: \"if_required\",\r\n        });\r\n\r\n      if (paymentError) {\r\n        console.error(\"Payment error:\", paymentError);\r\n        throw paymentError;\r\n      }\r\n\r\n      if (paymentIntent.status === \"succeeded\") {\r\n        console.log(\"Payment succeeded, creating order...\");\r\n        const { orderId } = await createOrder(paymentIntent);\r\n        clearCart();\r\n        navigate(\"/confirmation\", {\r\n          state: {\r\n            orderId,\r\n            status: \"success\",\r\n            paymentIntentId: paymentIntent.id,\r\n          },\r\n          replace: true,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Payment/Order error:\", error);\r\n      setError(error.message);\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const { subtotal, total } = calculateTotals();\r\n\r\n  return (\r\n    <div className=\"payment-container\">\r\n      <ProgressSteps currentStep={2} />\r\n\r\n      <div className=\"payment-header\">\r\n        <h1>Secure Payment</h1>\r\n        <div className=\"order-summary\">\r\n          <h2>Order Summary</h2>\r\n          <div className=\"items-list\">\r\n            {cart.map((item) => (\r\n              <div\r\n                key={`${item.id || item._id}-${item.size || \"regular\"}`}\r\n                className=\"order-item\"\r\n              >\r\n                <div className=\"item-info\">\r\n                  <span className=\"item-name\">{item.name}</span>\r\n                  {item.size && <span className=\"item-size\">{item.size}</span>}\r\n                </div>\r\n                <div className=\"item-price\">\r\n                  <span className=\"quantity\">x{item.quantity}</span>\r\n                  <span className=\"price\">\r\n                    £\r\n                    {(\r\n                      (item.selectedPrice || item.price) * item.quantity\r\n                    ).toFixed(2)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"price-breakdown\">\r\n            <div className=\"price-row\">\r\n              <span>Subtotal</span>\r\n              <span>£{subtotal.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"price-row\">\r\n              <span>Delivery Fee</span>\r\n              <span>£{DELIVERY_FEE.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"price-row total\">\r\n              <span>Total to Pay</span>\r\n              <span>£{total.toFixed(2)}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"delivery-info\">\r\n          <h3>Delivery Details</h3>\r\n          {orderDetails?.customerInfo &&\r\n            Object.entries(orderDetails.customerInfo).map(\r\n              ([key, value]) =>\r\n                key !== \"email\" &&\r\n                key !== \"specialInstructions\" && (\r\n                  <div key={key} className=\"info-row\">\r\n                    <span>\r\n                      {key.charAt(0).toUpperCase() +\r\n                        key.slice(1).replace(/([A-Z])/g, \" $1\")}\r\n                      :\r\n                    </span>\r\n                    <span>{value}</span>\r\n                  </div>\r\n                )\r\n            )}\r\n          {orderDetails?.customerInfo?.specialInstructions && (\r\n            <div className=\"special-instructions\">\r\n              <h4>Special Instructions:</h4>\r\n              <p>{orderDetails.customerInfo.specialInstructions}</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"payment-form\">\r\n        <div className=\"payment-element-container\">\r\n          <PaymentElement />\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"error-message\" role=\"alert\">\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <button\r\n          type=\"submit\"\r\n          className=\"payment-button\"\r\n          disabled={!stripe || isProcessing}\r\n        >\r\n          <div className=\"button-content\">\r\n            {isProcessing ? (\r\n              <>\r\n                <div\r\n                  className=\"spinner\"\r\n                  role=\"status\"\r\n                  aria-label=\"Processing payment\"\r\n                />\r\n                <span>Processing...</span>\r\n              </>\r\n            ) : (\r\n              <span>Pay £{total.toFixed(2)}</span>\r\n            )}\r\n          </div>\r\n        </button>\r\n      </form>\r\n\r\n      <div className=\"security-info\">\r\n        <p>🔒 All payments are secure and encrypted</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PaymentPage() {\r\n  const [clientSecret, setClientSecret] = useState(\"\");\r\n  const [error, setError] = useState(null);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { cart } = useCart();\r\n\r\n  const orderDetails = location.state?.orderDetails;\r\n\r\n  useEffect(() => {\r\n    if (!orderDetails || !cart?.length) {\r\n      console.log(\"Invalid payment page access, redirecting to checkout\");\r\n      navigate(\"/checkout\");\r\n      return;\r\n    }\r\n\r\n    const createPaymentIntent = async () => {\r\n      try {\r\n        console.log(\"Creating payment intent...\");\r\n        console.log(\"API URL:\", api.defaults.baseURL);\r\n\r\n        const response = await api.post(\"/orders/create-payment-intent\", {\r\n          amount: orderDetails.totalAmount,\r\n          currency: \"gbp\",\r\n          metadata: {\r\n            customerName: orderDetails.customerInfo.name,\r\n            customerEmail: orderDetails.customerInfo.email,\r\n          },\r\n        });\r\n\r\n        console.log(\"Payment intent created:\", response.data);\r\n        setClientSecret(response.data.clientSecret);\r\n      } catch (error) {\r\n        console.error(\"Payment setup error:\", error);\r\n        console.error(\"Error details:\", {\r\n          message: error.message,\r\n          response: error.response?.data,\r\n          status: error.response?.status,\r\n          config: error.config,\r\n        });\r\n        setError(\r\n          error.response?.data?.message ||\r\n            \"Failed to setup payment. Please try again.\"\r\n        );\r\n      }\r\n    };\r\n\r\n    createPaymentIntent();\r\n  }, [cart, orderDetails, navigate]);\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"error-container\" role=\"alert\">\r\n        <h2>Payment Setup Failed</h2>\r\n        <p>{error}</p>\r\n        <button onClick={() => navigate(\"/checkout\")} className=\"return-button\">\r\n          Return to Checkout\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!clientSecret) {\r\n    return (\r\n      <div className=\"loading-container\" role=\"status\">\r\n        <div className=\"spinner\" />\r\n        <p>Setting up payment...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"payment-page\">\r\n      <Elements\r\n        stripe={stripePromise}\r\n        options={{\r\n          clientSecret,\r\n          appearance: {\r\n            theme: \"stripe\",\r\n            variables: {\r\n              colorPrimary: \"#0a5c66\",\r\n              colorBackground: \"#ffffff\",\r\n              colorText: \"#30313d\",\r\n            },\r\n          },\r\n        }}\r\n      >\r\n        <CheckoutForm />\r\n      </Elements>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default PaymentPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}