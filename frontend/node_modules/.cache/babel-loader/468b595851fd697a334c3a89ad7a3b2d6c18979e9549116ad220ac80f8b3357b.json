{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rui Seca\\\\savannah-bites\\\\frontend\\\\src\\\\components\\\\PaymentPage\\\\index.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { PaymentElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { useCart } from \"../../context/CartContext\";\nimport ProgressSteps from \"../ProgressSteps/index.jsx\";\nimport { paymentAPI } from \"../../config/api\"; // Only import what you need\nimport \"./styles.css\";\n\n// Stripe initialization\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\nconst DELIVERY_FEE = 2.5;\nfunction CheckoutForm() {\n  _s();\n  var _location$state, _orderDetails$custome;\n  const stripe = useStripe();\n  const elements = useElements();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    cart,\n    clearCart\n  } = useCart();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState(null);\n  const orderDetails = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.orderDetails;\n\n  // Validate order details\n  useEffect(() => {\n    if (!(orderDetails !== null && orderDetails !== void 0 && orderDetails.customerInfo) || !cart.length) {\n      console.log(\"Missing order details or empty cart, redirecting to checkout\");\n      navigate(\"/checkout\");\n    }\n  }, [orderDetails, cart, navigate]);\n  const calculateTotals = () => {\n    const subtotal = cart.reduce((sum, item) => sum + (item.selectedPrice || item.price) * item.quantity, 0);\n    return {\n      subtotal,\n      deliveryFee: DELIVERY_FEE,\n      total: subtotal + DELIVERY_FEE\n    };\n  };\n  const createOrder = async paymentIntent => {\n    try {\n      console.log(\"Creating order...\");\n      const {\n        subtotal,\n        deliveryFee,\n        total\n      } = calculateTotals();\n      const orderData = {\n        paymentIntentId: paymentIntent.id,\n        orderDetails: {\n          items: cart.map(item => ({\n            id: item._id || item.id,\n            name: item.name,\n            quantity: item.quantity,\n            price: item.selectedPrice || item.price,\n            size: item.size || \"regular\"\n          })),\n          subtotal,\n          deliveryFee,\n          totalAmount: total,\n          customerInfo: orderDetails.customerInfo\n        }\n      };\n      console.log(\"Sending order data:\", orderData);\n      const response = await paymentAPI.createOrder(orderData);\n      console.log(\"Order created successfully:\", response);\n      return response;\n    } catch (error) {\n      var _error$data;\n      console.error(\"Order creation failed:\", error);\n      throw new Error(\"Failed to create order: \" + (((_error$data = error.data) === null || _error$data === void 0 ? void 0 : _error$data.message) || error.message));\n    }\n  };\n  const handleSubmit = async event => {\n    event.preventDefault();\n    if (!stripe || !elements || isProcessing) {\n      return;\n    }\n    try {\n      setIsProcessing(true);\n      setError(null);\n      console.log(\"Submitting payment form...\");\n      const {\n        error: submitError\n      } = await elements.submit();\n      if (submitError) {\n        throw submitError;\n      }\n      console.log(\"Confirming payment...\");\n      const {\n        error: paymentError,\n        paymentIntent\n      } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: `${window.location.origin}/confirmation`,\n          payment_method_data: {\n            billing_details: {\n              name: orderDetails.customerInfo.name,\n              email: orderDetails.customerInfo.email,\n              phone: orderDetails.customerInfo.phone,\n              address: {\n                line1: orderDetails.customerInfo.address,\n                city: orderDetails.customerInfo.city,\n                postal_code: orderDetails.customerInfo.postcode,\n                country: \"GB\"\n              }\n            }\n          }\n        },\n        redirect: \"if_required\"\n      });\n      if (paymentError) {\n        console.error(\"Payment error:\", paymentError);\n        throw paymentError;\n      }\n      if (paymentIntent.status === \"succeeded\") {\n        console.log(\"Payment succeeded, creating order...\");\n        const {\n          orderId\n        } = await createOrder(paymentIntent);\n        clearCart();\n        navigate(\"/confirmation\", {\n          state: {\n            orderId,\n            status: \"success\",\n            paymentIntentId: paymentIntent.id\n          },\n          replace: true\n        });\n      }\n    } catch (error) {\n      console.error(\"Payment/Order error:\", error);\n      setError(error.message);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  const {\n    subtotal,\n    total\n  } = calculateTotals();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-container\",\n    children: [/*#__PURE__*/_jsxDEV(ProgressSteps, {\n      currentStep: 2\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"payment-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Secure Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"order-summary\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Order Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"items-list\",\n          children: cart.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"order-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"item-name\",\n                children: item.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 170,\n                columnNumber: 19\n              }, this), item.size && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"item-size\",\n                children: item.size\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 171,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-price\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"quantity\",\n                children: [\"x\", item.quantity]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 174,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"price\",\n                children: [\"\\xA3\", ((item.selectedPrice || item.price) * item.quantity).toFixed(2)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 175,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 173,\n              columnNumber: 17\n            }, this)]\n          }, `${item.id || item._id}-${item.size || \"regular\"}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"price-breakdown\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Subtotal\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", subtotal.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Delivery Fee\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", DELIVERY_FEE.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row total\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Total to Pay\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 196,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", total.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 197,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"delivery-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Delivery Details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 11\n        }, this), (orderDetails === null || orderDetails === void 0 ? void 0 : orderDetails.customerInfo) && Object.entries(orderDetails.customerInfo).map(([key, value]) => key !== \"email\" && key !== \"specialInstructions\" && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"info-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: [key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, \" $1\"), \":\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: value\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 21\n          }, this)]\n        }, key, true, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 19\n        }, this)), (orderDetails === null || orderDetails === void 0 ? void 0 : (_orderDetails$custome = orderDetails.customerInfo) === null || _orderDetails$custome === void 0 ? void 0 : _orderDetails$custome.specialInstructions) && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"special-instructions\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Special Instructions:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: orderDetails.customerInfo.specialInstructions\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"payment-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"payment-element-container\",\n        children: /*#__PURE__*/_jsxDEV(PaymentElement, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        role: \"alert\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"payment-button\",\n        disabled: !stripe || isProcessing,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-content\",\n          children: isProcessing ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"spinner\",\n              role: \"status\",\n              \"aria-label\": \"Processing payment\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Processing...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Pay \\xA3\", total.toFixed(2)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"security-info\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"\\uD83D\\uDD12 All payments are secure and encrypted\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 156,\n    columnNumber: 5\n  }, this);\n}\n_s(CheckoutForm, \"na5PFFw6chbSUMgTqbnM1WwBVyM=\", false, function () {\n  return [useStripe, useElements, useNavigate, useLocation, useCart];\n});\n_c = CheckoutForm;\nfunction PaymentPage() {\n  _s2();\n  var _location$state2;\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [error, setError] = useState(null);\n  const location = useLocation();\n  const navigate = useNavigate();\n  const {\n    cart\n  } = useCart();\n  const orderDetails = (_location$state2 = location.state) === null || _location$state2 === void 0 ? void 0 : _location$state2.orderDetails;\n  useEffect(() => {\n    if (!orderDetails || !(cart !== null && cart !== void 0 && cart.length)) {\n      console.log(\"Invalid payment page access, redirecting to checkout\");\n      navigate(\"/checkout\");\n      return;\n    }\n    const createPaymentIntent = async () => {\n      try {\n        console.log(\"Creating payment intent...\");\n\n        // Use the paymentAPI method instead of direct axios call\n        const response = await paymentAPI.createPaymentIntent({\n          amount: orderDetails.totalAmount,\n          currency: \"gbp\",\n          metadata: {\n            customerName: orderDetails.customerInfo.name,\n            customerEmail: orderDetails.customerInfo.email\n          }\n        });\n        console.log(\"Payment intent created:\", response);\n\n        // The response is already processed by your API layer\n        setClientSecret(response.clientSecret);\n      } catch (error) {\n        var _error$data2;\n        console.error(\"Payment setup error:\", error);\n\n        // Error is already formatted by your API layer\n        setError(((_error$data2 = error.data) === null || _error$data2 === void 0 ? void 0 : _error$data2.message) || error.message || \"Failed to setup payment. Please try again.\");\n      }\n    };\n    createPaymentIntent();\n  }, [cart, orderDetails, navigate]);\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-container\",\n      role: \"alert\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Payment Setup Failed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate(\"/checkout\"),\n        className: \"return-button\",\n        children: \"Return to Checkout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 7\n    }, this);\n  }\n  if (!clientSecret) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      role: \"status\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Setting up payment...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-page\",\n    children: /*#__PURE__*/_jsxDEV(Elements, {\n      stripe: stripePromise,\n      options: {\n        clientSecret,\n        appearance: {\n          theme: \"stripe\",\n          variables: {\n            colorPrimary: \"#0a5c66\",\n            colorBackground: \"#ffffff\",\n            colorText: \"#30313d\"\n          }\n        }\n      },\n      children: /*#__PURE__*/_jsxDEV(CheckoutForm, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 339,\n    columnNumber: 5\n  }, this);\n}\n_s2(PaymentPage, \"aDNKusgezv9q3SH/CUvy39hgiwI=\", false, function () {\n  return [useLocation, useNavigate, useCart];\n});\n_c2 = PaymentPage;\nexport default PaymentPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"CheckoutForm\");\n$RefreshReg$(_c2, \"PaymentPage\");","map":{"version":3,"names":["React","useEffect","useState","Elements","PaymentElement","useStripe","useElements","loadStripe","useNavigate","useLocation","useCart","ProgressSteps","paymentAPI","jsxDEV","_jsxDEV","Fragment","_Fragment","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","DELIVERY_FEE","CheckoutForm","_s","_location$state","_orderDetails$custome","stripe","elements","navigate","location","cart","clearCart","isProcessing","setIsProcessing","error","setError","orderDetails","state","customerInfo","length","console","log","calculateTotals","subtotal","reduce","sum","item","selectedPrice","price","quantity","deliveryFee","total","createOrder","paymentIntent","orderData","paymentIntentId","id","items","map","_id","name","size","totalAmount","response","_error$data","Error","data","message","handleSubmit","event","preventDefault","submitError","submit","paymentError","confirmPayment","confirmParams","return_url","window","origin","payment_method_data","billing_details","email","phone","address","line1","city","postal_code","postcode","country","redirect","status","orderId","replace","className","children","currentStep","fileName","_jsxFileName","lineNumber","columnNumber","toFixed","Object","entries","key","value","charAt","toUpperCase","slice","specialInstructions","onSubmit","role","type","disabled","_c","PaymentPage","_s2","_location$state2","clientSecret","setClientSecret","createPaymentIntent","amount","currency","metadata","customerName","customerEmail","_error$data2","onClick","options","appearance","theme","variables","colorPrimary","colorBackground","colorText","_c2","$RefreshReg$"],"sources":["C:/Users/Rui Seca/savannah-bites/frontend/src/components/PaymentPage/index.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { Elements } from \"@stripe/react-stripe-js\";\r\nimport {\r\n  PaymentElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport { useCart } from \"../../context/CartContext\";\r\nimport ProgressSteps from \"../ProgressSteps/index.jsx\";\r\nimport { paymentAPI } from \"../../config/api\"; // Only import what you need\r\nimport \"./styles.css\";\r\n\r\n// Stripe initialization\r\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\r\n\r\nconst DELIVERY_FEE = 2.5;\r\n\r\nfunction CheckoutForm() {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { cart, clearCart } = useCart();\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  const orderDetails = location.state?.orderDetails;\r\n\r\n  // Validate order details\r\n  useEffect(() => {\r\n    if (!orderDetails?.customerInfo || !cart.length) {\r\n      console.log(\r\n        \"Missing order details or empty cart, redirecting to checkout\"\r\n      );\r\n      navigate(\"/checkout\");\r\n    }\r\n  }, [orderDetails, cart, navigate]);\r\n\r\n  const calculateTotals = () => {\r\n    const subtotal = cart.reduce(\r\n      (sum, item) => sum + (item.selectedPrice || item.price) * item.quantity,\r\n      0\r\n    );\r\n    return {\r\n      subtotal,\r\n      deliveryFee: DELIVERY_FEE,\r\n      total: subtotal + DELIVERY_FEE,\r\n    };\r\n  };\r\n\r\n  const createOrder = async (paymentIntent) => {\r\n    try {\r\n      console.log(\"Creating order...\");\r\n      const { subtotal, deliveryFee, total } = calculateTotals();\r\n\r\n      const orderData = {\r\n        paymentIntentId: paymentIntent.id,\r\n        orderDetails: {\r\n          items: cart.map((item) => ({\r\n            id: item._id || item.id,\r\n            name: item.name,\r\n            quantity: item.quantity,\r\n            price: item.selectedPrice || item.price,\r\n            size: item.size || \"regular\",\r\n          })),\r\n          subtotal,\r\n          deliveryFee,\r\n          totalAmount: total,\r\n          customerInfo: orderDetails.customerInfo,\r\n        },\r\n      };\r\n\r\n      console.log(\"Sending order data:\", orderData);\r\n      const response = await paymentAPI.createOrder(orderData);\r\n      console.log(\"Order created successfully:\", response);\r\n      return response;\r\n    } catch (error) {\r\n      console.error(\"Order creation failed:\", error);\r\n      throw new Error(\r\n        \"Failed to create order: \" + (error.data?.message || error.message)\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n\r\n    if (!stripe || !elements || isProcessing) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsProcessing(true);\r\n      setError(null);\r\n\r\n      console.log(\"Submitting payment form...\");\r\n      const { error: submitError } = await elements.submit();\r\n      if (submitError) {\r\n        throw submitError;\r\n      }\r\n\r\n      console.log(\"Confirming payment...\");\r\n      const { error: paymentError, paymentIntent } =\r\n        await stripe.confirmPayment({\r\n          elements,\r\n          confirmParams: {\r\n            return_url: `${window.location.origin}/confirmation`,\r\n            payment_method_data: {\r\n              billing_details: {\r\n                name: orderDetails.customerInfo.name,\r\n                email: orderDetails.customerInfo.email,\r\n                phone: orderDetails.customerInfo.phone,\r\n                address: {\r\n                  line1: orderDetails.customerInfo.address,\r\n                  city: orderDetails.customerInfo.city,\r\n                  postal_code: orderDetails.customerInfo.postcode,\r\n                  country: \"GB\",\r\n                },\r\n              },\r\n            },\r\n          },\r\n          redirect: \"if_required\",\r\n        });\r\n\r\n      if (paymentError) {\r\n        console.error(\"Payment error:\", paymentError);\r\n        throw paymentError;\r\n      }\r\n\r\n      if (paymentIntent.status === \"succeeded\") {\r\n        console.log(\"Payment succeeded, creating order...\");\r\n        const { orderId } = await createOrder(paymentIntent);\r\n        clearCart();\r\n        navigate(\"/confirmation\", {\r\n          state: {\r\n            orderId,\r\n            status: \"success\",\r\n            paymentIntentId: paymentIntent.id,\r\n          },\r\n          replace: true,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Payment/Order error:\", error);\r\n      setError(error.message);\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const { subtotal, total } = calculateTotals();\r\n\r\n  return (\r\n    <div className=\"payment-container\">\r\n      <ProgressSteps currentStep={2} />\r\n\r\n      <div className=\"payment-header\">\r\n        <h1>Secure Payment</h1>\r\n        <div className=\"order-summary\">\r\n          <h2>Order Summary</h2>\r\n          <div className=\"items-list\">\r\n            {cart.map((item) => (\r\n              <div\r\n                key={`${item.id || item._id}-${item.size || \"regular\"}`}\r\n                className=\"order-item\"\r\n              >\r\n                <div className=\"item-info\">\r\n                  <span className=\"item-name\">{item.name}</span>\r\n                  {item.size && <span className=\"item-size\">{item.size}</span>}\r\n                </div>\r\n                <div className=\"item-price\">\r\n                  <span className=\"quantity\">x{item.quantity}</span>\r\n                  <span className=\"price\">\r\n                    Â£\r\n                    {(\r\n                      (item.selectedPrice || item.price) * item.quantity\r\n                    ).toFixed(2)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"price-breakdown\">\r\n            <div className=\"price-row\">\r\n              <span>Subtotal</span>\r\n              <span>Â£{subtotal.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"price-row\">\r\n              <span>Delivery Fee</span>\r\n              <span>Â£{DELIVERY_FEE.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"price-row total\">\r\n              <span>Total to Pay</span>\r\n              <span>Â£{total.toFixed(2)}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"delivery-info\">\r\n          <h3>Delivery Details</h3>\r\n          {orderDetails?.customerInfo &&\r\n            Object.entries(orderDetails.customerInfo).map(\r\n              ([key, value]) =>\r\n                key !== \"email\" &&\r\n                key !== \"specialInstructions\" && (\r\n                  <div key={key} className=\"info-row\">\r\n                    <span>\r\n                      {key.charAt(0).toUpperCase() +\r\n                        key.slice(1).replace(/([A-Z])/g, \" $1\")}\r\n                      :\r\n                    </span>\r\n                    <span>{value}</span>\r\n                  </div>\r\n                )\r\n            )}\r\n          {orderDetails?.customerInfo?.specialInstructions && (\r\n            <div className=\"special-instructions\">\r\n              <h4>Special Instructions:</h4>\r\n              <p>{orderDetails.customerInfo.specialInstructions}</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"payment-form\">\r\n        <div className=\"payment-element-container\">\r\n          <PaymentElement />\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"error-message\" role=\"alert\">\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <button\r\n          type=\"submit\"\r\n          className=\"payment-button\"\r\n          disabled={!stripe || isProcessing}\r\n        >\r\n          <div className=\"button-content\">\r\n            {isProcessing ? (\r\n              <>\r\n                <div\r\n                  className=\"spinner\"\r\n                  role=\"status\"\r\n                  aria-label=\"Processing payment\"\r\n                />\r\n                <span>Processing...</span>\r\n              </>\r\n            ) : (\r\n              <span>Pay Â£{total.toFixed(2)}</span>\r\n            )}\r\n          </div>\r\n        </button>\r\n      </form>\r\n\r\n      <div className=\"security-info\">\r\n        <p>ðŸ”’ All payments are secure and encrypted</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PaymentPage() {\r\n  const [clientSecret, setClientSecret] = useState(\"\");\r\n  const [error, setError] = useState(null);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { cart } = useCart();\r\n\r\n  const orderDetails = location.state?.orderDetails;\r\n\r\n  useEffect(() => {\r\n    if (!orderDetails || !cart?.length) {\r\n      console.log(\"Invalid payment page access, redirecting to checkout\");\r\n      navigate(\"/checkout\");\r\n      return;\r\n    }\r\n\r\n    const createPaymentIntent = async () => {\r\n      try {\r\n        console.log(\"Creating payment intent...\");\r\n\r\n        // Use the paymentAPI method instead of direct axios call\r\n        const response = await paymentAPI.createPaymentIntent({\r\n          amount: orderDetails.totalAmount,\r\n          currency: \"gbp\",\r\n          metadata: {\r\n            customerName: orderDetails.customerInfo.name,\r\n            customerEmail: orderDetails.customerInfo.email,\r\n          },\r\n        });\r\n\r\n        console.log(\"Payment intent created:\", response);\r\n\r\n        // The response is already processed by your API layer\r\n        setClientSecret(response.clientSecret);\r\n      } catch (error) {\r\n        console.error(\"Payment setup error:\", error);\r\n\r\n        // Error is already formatted by your API layer\r\n        setError(\r\n          error.data?.message ||\r\n            error.message ||\r\n            \"Failed to setup payment. Please try again.\"\r\n        );\r\n      }\r\n    };\r\n\r\n    createPaymentIntent();\r\n  }, [cart, orderDetails, navigate]);\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"error-container\" role=\"alert\">\r\n        <h2>Payment Setup Failed</h2>\r\n        <p>{error}</p>\r\n        <button onClick={() => navigate(\"/checkout\")} className=\"return-button\">\r\n          Return to Checkout\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!clientSecret) {\r\n    return (\r\n      <div className=\"loading-container\" role=\"status\">\r\n        <div className=\"spinner\" />\r\n        <p>Setting up payment...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"payment-page\">\r\n      <Elements\r\n        stripe={stripePromise}\r\n        options={{\r\n          clientSecret,\r\n          appearance: {\r\n            theme: \"stripe\",\r\n            variables: {\r\n              colorPrimary: \"#0a5c66\",\r\n              colorBackground: \"#ffffff\",\r\n              colorText: \"#30313d\",\r\n            },\r\n          },\r\n        }}\r\n      >\r\n        <CheckoutForm />\r\n      </Elements>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default PaymentPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}