{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rui Seca\\\\savannah-bites\\\\frontend\\\\src\\\\components\\\\PaymentPage\\\\index.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { PaymentElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { useCart } from \"../../context/CartContext\";\nimport ProgressSteps from \"../ProgressSteps\";\nimport { paymentAPI } from \"../../config/api\";\nimport \"./styles.css\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\nconst DELIVERY_FEE = 2.5;\n\n// Validation functions\nconst validateCartItem = item => {\n  if (!item) throw new Error(\"Invalid cart item\");\n  const price = Number(item.selectedPrice || item.price);\n  const quantity = Number(item.quantity);\n  if (isNaN(price) || price <= 0) {\n    throw new Error(`Invalid price for item: ${item.name}`);\n  }\n  if (!Number.isInteger(quantity) || quantity <= 0) {\n    throw new Error(`Invalid quantity for item: ${item.name}`);\n  }\n  return {\n    price,\n    quantity\n  };\n};\nconst validateCartAndCalculateTotals = cart => {\n  if (!Array.isArray(cart) || cart.length === 0) {\n    throw new Error(\"Cart is empty or invalid\");\n  }\n  const itemTotals = cart.map(item => {\n    const {\n      price,\n      quantity\n    } = validateCartItem(item);\n    return price * quantity;\n  });\n  const subtotal = Number(itemTotals.reduce((sum, total) => sum + total, 0).toFixed(2));\n  const total = Number((subtotal + DELIVERY_FEE).toFixed(2));\n  const amountInCents = Math.round(total * 100);\n  return {\n    subtotal,\n    deliveryFee: DELIVERY_FEE,\n    total,\n    amountInCents\n  };\n};\nconst validateCustomerInfo = customerInfo => {\n  if (!customerInfo) throw new Error(\"Customer information is required\");\n  const requiredFields = [\"name\", \"email\", \"phone\", \"address\", \"city\", \"postcode\", \"deliveryTime\"];\n  const missingFields = requiredFields.filter(field => !customerInfo[field]);\n  if (missingFields.length > 0) {\n    throw new Error(`Missing required fields: ${missingFields.join(\", \")}`);\n  }\n\n  // Email validation\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  if (!emailRegex.test(customerInfo.email)) {\n    throw new Error(\"Invalid email format\");\n  }\n\n  // UK postcode validation\n  const postcodeRegex = /^[A-Z]{1,2}[0-9][A-Z0-9]?\\s?[0-9][A-Z]{2}$/i;\n  if (!postcodeRegex.test(customerInfo.postcode.trim())) {\n    throw new Error(\"Invalid UK postcode format\");\n  }\n\n  // Phone validation\n  const phoneRegex = /^[\\d\\s-+()]{10,}$/;\n  if (!phoneRegex.test(customerInfo.phone.replace(/\\s+/g, \"\"))) {\n    throw new Error(\"Invalid phone number format\");\n  }\n};\nfunction CheckoutForm({\n  orderDetails,\n  clientSecret\n}) {\n  _s();\n  const stripe = useStripe();\n  const elements = useElements();\n  const navigate = useNavigate();\n  const {\n    cart,\n    clearCart\n  } = useCart();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState(null);\n  const handleSubmit = async event => {\n    event.preventDefault();\n    if (!stripe || !elements || isProcessing || !clientSecret) {\n      return;\n    }\n    try {\n      setIsProcessing(true);\n      setError(null);\n      const totals = validateCartAndCalculateTotals(cart);\n\n      // Submit the payment form\n      const {\n        error: submitError\n      } = await elements.submit();\n      if (submitError) {\n        throw new Error(`Payment submission failed: ${submitError.message}`);\n      }\n\n      // Confirm payment\n      const {\n        error: paymentError,\n        paymentIntent\n      } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: `${window.location.origin}/confirmation`,\n          payment_method_data: {\n            billing_details: {\n              name: orderDetails.customerInfo.name,\n              email: orderDetails.customerInfo.email,\n              phone: orderDetails.customerInfo.phone,\n              address: {\n                line1: orderDetails.customerInfo.address,\n                city: orderDetails.customerInfo.city,\n                postal_code: orderDetails.customerInfo.postcode,\n                country: \"GB\"\n              }\n            }\n          }\n        },\n        redirect: \"if_required\"\n      });\n      if (paymentError) {\n        throw new Error(paymentError.message || \"Payment failed\");\n      }\n      if (paymentIntent.status === \"succeeded\") {\n        try {\n          const orderData = {\n            paymentIntentId: paymentIntent.id,\n            orderDetails: cart.map(item => ({\n              item: item._id || item.id,\n              name: item.name,\n              quantity: parseInt(item.quantity, 10),\n              price: Number(item.selectedPrice || item.price),\n              size: item.size || \"regular\",\n              // Add modifiers if needed\n              modifiers: []\n            })),\n            customer: {\n              name: orderDetails.customerInfo.name,\n              email: orderDetails.customerInfo.email.toLowerCase().trim(),\n              phone: orderDetails.customerInfo.phone\n            },\n            address: {\n              street: orderDetails.customerInfo.address.trim(),\n              city: orderDetails.customerInfo.city.trim(),\n              postcode: orderDetails.customerInfo.postcode.toUpperCase().trim()\n            },\n            amount: {\n              subtotal: totals.subtotal,\n              deliveryFee: totals.deliveryFee,\n              total: totals.total,\n              discount: 0\n            },\n            paymentDetails: {\n              paymentIntentId: paymentIntent.id,\n              method: \"card\",\n              status: \"succeeded\"\n            },\n            deliveryTime: {\n              requested: new Date(orderDetails.customerInfo.deliveryTime)\n            },\n            specialInstructions: orderDetails.customerInfo.specialInstructions || \"\",\n            orderStatus: {\n              current: \"pending\",\n              history: [{\n                status: \"pending\",\n                timestamp: new Date(),\n                note: \"Order placed\"\n              }]\n            }\n          };\n          const {\n            orderId\n          } = await paymentAPI.createOrder(orderData);\n          clearCart();\n\n          // Store order information\n          sessionStorage.setItem(\"orderId\", orderId);\n          sessionStorage.setItem(\"paymentIntentId\", paymentIntent.id);\n\n          // Navigate to confirmation\n          navigate(\"/confirmation\", {\n            state: {\n              orderId,\n              paymentIntentId: paymentIntent.id\n            },\n            replace: true\n          });\n        } catch (orderError) {\n          throw new Error(`Payment successful but order creation failed: ${orderError.message}`);\n        }\n      }\n    } catch (error) {\n      console.error(\"Payment processing error:\", error);\n      setError(error.message || \"Payment processing failed\");\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  const totals = validateCartAndCalculateTotals(cart);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-container\",\n    children: [/*#__PURE__*/_jsxDEV(ProgressSteps, {\n      currentStep: 2\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"payment-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Secure Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"order-summary\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Order Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"items-list\",\n          children: cart.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"order-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"item-name\",\n                children: item.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 248,\n                columnNumber: 19\n              }, this), item.size && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"item-size\",\n                children: [\"(\", item.size, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"item-price\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"quantity\",\n                children: [\"x\", item.quantity]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 254,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"price\",\n                children: [\"\\xA3\", (item.price * item.quantity).toFixed(2)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 17\n            }, this)]\n          }, `${item.id}-${item.size || \"regular\"}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"price-breakdown\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Subtotal\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", totals.subtotal.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Delivery Fee\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", totals.deliveryFee.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 270,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-row total\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Total to Pay\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 273,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\xA3\", totals.total.toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 274,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"delivery-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Delivery Details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 11\n        }, this), (orderDetails === null || orderDetails === void 0 ? void 0 : orderDetails.customerInfo) && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Name:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 284,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 285,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 283,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Phone:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 288,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.phone\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Address:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.address\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"City:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 296,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.city\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Postcode:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.postcode\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 301,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Delivery Time:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 304,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: orderDetails.customerInfo.deliveryTime\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 15\n          }, this), orderDetails.customerInfo.specialInstructions && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"special-instructions\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"Special Instructions:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 309,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: orderDetails.customerInfo.specialInstructions\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"payment-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"payment-element-container\",\n        children: /*#__PURE__*/_jsxDEV(PaymentElement, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        role: \"alert\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"payment-button\",\n        disabled: !stripe || isProcessing,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-content\",\n          children: isProcessing ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"spinner\",\n              role: \"status\",\n              \"aria-label\": \"Processing payment\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Processing...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 342,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Pay \\xA3\", totals.total.toFixed(2)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 329,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"security-info\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"\\uD83D\\uDD12 All payments are secure and encrypted\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 352,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 233,\n    columnNumber: 5\n  }, this);\n}\n_s(CheckoutForm, \"NjL6IuXhiwfitC2x4vV2nn5ROCc=\", false, function () {\n  return [useStripe, useElements, useNavigate, useCart];\n});\n_c = CheckoutForm;\nfunction PaymentPage() {\n  _s2();\n  var _location$state;\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const location = useLocation();\n  const navigate = useNavigate();\n  const {\n    cart\n  } = useCart();\n  const orderDetails = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.orderDetails;\n  useEffect(() => {\n    const initializePayment = async () => {\n      try {\n        if (!(orderDetails !== null && orderDetails !== void 0 && orderDetails.customerInfo)) {\n          throw new Error(\"Please complete your delivery information\");\n        }\n        if (!(cart !== null && cart !== void 0 && cart.length)) {\n          throw new Error(\"Your cart is empty\");\n        }\n        validateCustomerInfo(orderDetails.customerInfo);\n        const {\n          amountInCents\n        } = validateCartAndCalculateTotals(cart);\n        console.log(\"Creating payment intent:\", {\n          amount: amountInCents,\n          customer: orderDetails.customerInfo.name\n        });\n        const response = await paymentAPI.createPaymentIntent({\n          amount: amountInCents,\n          currency: \"gbp\",\n          metadata: {\n            customerName: orderDetails.customerInfo.name,\n            customerEmail: orderDetails.customerInfo.email,\n            integration_check: \"accept_a_payment\"\n          }\n        });\n        console.log(\"Payment intent response:\", {\n          hasClientSecret: !!response.clientSecret,\n          hasId: !!response.id\n        });\n        if (!response.clientSecret) {\n          throw new Error(\"Failed to initialize payment\");\n        }\n        setClientSecret(response.clientSecret);\n      } catch (error) {\n        console.error(\"Payment initialization failed:\", error);\n        setError(error.message);\n        // Add a slight delay before navigation\n        setTimeout(() => {\n          navigate(\"/checkout\", {\n            state: {\n              error: error.message\n            }\n          });\n        }, 100);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    // Only initialize payment if we have order details and cart\n    if (orderDetails && cart !== null && cart !== void 0 && cart.length) {\n      initializePayment();\n    } else {\n      setLoading(false);\n      setError(\"Missing order details or empty cart\");\n      setTimeout(() => navigate(\"/checkout\"), 100);\n    }\n  }, [cart, orderDetails, navigate]); // Keep these dependencies\n\n  // Loading state\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      role: \"status\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 435,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Setting up payment...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 434,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Error state\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-container\",\n      role: \"alert\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Payment Setup Failed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate(\"/checkout\"),\n        className: \"return-button\",\n        children: \"Return to Checkout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 447,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 444,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Success state\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-page\",\n    children: clientSecret && /*#__PURE__*/_jsxDEV(Elements, {\n      stripe: stripePromise,\n      options: {\n        clientSecret,\n        appearance: {\n          theme: \"stripe\",\n          variables: {\n            colorPrimary: \"#0a5c66\",\n            colorBackground: \"#ffffff\",\n            colorText: \"#30313d\"\n          }\n        }\n      },\n      children: /*#__PURE__*/_jsxDEV(CheckoutForm, {\n        orderDetails: orderDetails,\n        clientSecret: clientSecret\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 458,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 456,\n    columnNumber: 5\n  }, this);\n}\n_s2(PaymentPage, \"Eoq4yd5UtjLFsd+qbYkTOG9Jok8=\", false, function () {\n  return [useLocation, useNavigate, useCart];\n});\n_c2 = PaymentPage;\nexport default PaymentPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"CheckoutForm\");\n$RefreshReg$(_c2, \"PaymentPage\");","map":{"version":3,"names":["React","useEffect","useState","Elements","PaymentElement","useStripe","useElements","loadStripe","useNavigate","useLocation","useCart","ProgressSteps","paymentAPI","jsxDEV","_jsxDEV","Fragment","_Fragment","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","DELIVERY_FEE","validateCartItem","item","Error","price","Number","selectedPrice","quantity","isNaN","name","isInteger","validateCartAndCalculateTotals","cart","Array","isArray","length","itemTotals","map","subtotal","reduce","sum","total","toFixed","amountInCents","Math","round","deliveryFee","validateCustomerInfo","customerInfo","requiredFields","missingFields","filter","field","join","emailRegex","test","email","postcodeRegex","postcode","trim","phoneRegex","phone","replace","CheckoutForm","orderDetails","clientSecret","_s","stripe","elements","navigate","clearCart","isProcessing","setIsProcessing","error","setError","handleSubmit","event","preventDefault","totals","submitError","submit","message","paymentError","paymentIntent","confirmPayment","confirmParams","return_url","window","location","origin","payment_method_data","billing_details","address","line1","city","postal_code","country","redirect","status","orderData","paymentIntentId","id","_id","parseInt","size","modifiers","customer","toLowerCase","street","toUpperCase","amount","discount","paymentDetails","method","deliveryTime","requested","Date","specialInstructions","orderStatus","current","history","timestamp","note","orderId","createOrder","sessionStorage","setItem","state","orderError","console","className","children","currentStep","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","role","type","disabled","_c","PaymentPage","_s2","_location$state","setClientSecret","loading","setLoading","initializePayment","log","response","createPaymentIntent","currency","metadata","customerName","customerEmail","integration_check","hasClientSecret","hasId","setTimeout","onClick","options","appearance","theme","variables","colorPrimary","colorBackground","colorText","_c2","$RefreshReg$"],"sources":["C:/Users/Rui Seca/savannah-bites/frontend/src/components/PaymentPage/index.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { Elements } from \"@stripe/react-stripe-js\";\r\nimport {\r\n  PaymentElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport { useCart } from \"../../context/CartContext\";\r\nimport ProgressSteps from \"../ProgressSteps\";\r\nimport { paymentAPI } from \"../../config/api\";\r\nimport \"./styles.css\";\r\n\r\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\r\n\r\nconst DELIVERY_FEE = 2.5;\r\n\r\n// Validation functions\r\nconst validateCartItem = (item) => {\r\n  if (!item) throw new Error(\"Invalid cart item\");\r\n\r\n  const price = Number(item.selectedPrice || item.price);\r\n  const quantity = Number(item.quantity);\r\n\r\n  if (isNaN(price) || price <= 0) {\r\n    throw new Error(`Invalid price for item: ${item.name}`);\r\n  }\r\n  if (!Number.isInteger(quantity) || quantity <= 0) {\r\n    throw new Error(`Invalid quantity for item: ${item.name}`);\r\n  }\r\n\r\n  return { price, quantity };\r\n};\r\n\r\nconst validateCartAndCalculateTotals = (cart) => {\r\n  if (!Array.isArray(cart) || cart.length === 0) {\r\n    throw new Error(\"Cart is empty or invalid\");\r\n  }\r\n\r\n  const itemTotals = cart.map((item) => {\r\n    const { price, quantity } = validateCartItem(item);\r\n    return price * quantity;\r\n  });\r\n\r\n  const subtotal = Number(\r\n    itemTotals.reduce((sum, total) => sum + total, 0).toFixed(2)\r\n  );\r\n  const total = Number((subtotal + DELIVERY_FEE).toFixed(2));\r\n  const amountInCents = Math.round(total * 100);\r\n\r\n  return {\r\n    subtotal,\r\n    deliveryFee: DELIVERY_FEE,\r\n    total,\r\n    amountInCents,\r\n  };\r\n};\r\nconst validateCustomerInfo = (customerInfo) => {\r\n  if (!customerInfo) throw new Error(\"Customer information is required\");\r\n\r\n  const requiredFields = [\r\n    \"name\",\r\n    \"email\",\r\n    \"phone\",\r\n    \"address\",\r\n    \"city\",\r\n    \"postcode\",\r\n    \"deliveryTime\",\r\n  ];\r\n\r\n  const missingFields = requiredFields.filter((field) => !customerInfo[field]);\r\n  if (missingFields.length > 0) {\r\n    throw new Error(`Missing required fields: ${missingFields.join(\", \")}`);\r\n  }\r\n\r\n  // Email validation\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n  if (!emailRegex.test(customerInfo.email)) {\r\n    throw new Error(\"Invalid email format\");\r\n  }\r\n\r\n  // UK postcode validation\r\n  const postcodeRegex = /^[A-Z]{1,2}[0-9][A-Z0-9]?\\s?[0-9][A-Z]{2}$/i;\r\n  if (!postcodeRegex.test(customerInfo.postcode.trim())) {\r\n    throw new Error(\"Invalid UK postcode format\");\r\n  }\r\n\r\n  // Phone validation\r\n  const phoneRegex = /^[\\d\\s-+()]{10,}$/;\r\n  if (!phoneRegex.test(customerInfo.phone.replace(/\\s+/g, \"\"))) {\r\n    throw new Error(\"Invalid phone number format\");\r\n  }\r\n};\r\n\r\nfunction CheckoutForm({ orderDetails, clientSecret }) {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const navigate = useNavigate();\r\n  const { cart, clearCart } = useCart();\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n\r\n    if (!stripe || !elements || isProcessing || !clientSecret) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsProcessing(true);\r\n      setError(null);\r\n\r\n      const totals = validateCartAndCalculateTotals(cart);\r\n\r\n      // Submit the payment form\r\n      const { error: submitError } = await elements.submit();\r\n      if (submitError) {\r\n        throw new Error(`Payment submission failed: ${submitError.message}`);\r\n      }\r\n\r\n      // Confirm payment\r\n      const { error: paymentError, paymentIntent } =\r\n        await stripe.confirmPayment({\r\n          elements,\r\n          confirmParams: {\r\n            return_url: `${window.location.origin}/confirmation`,\r\n            payment_method_data: {\r\n              billing_details: {\r\n                name: orderDetails.customerInfo.name,\r\n                email: orderDetails.customerInfo.email,\r\n                phone: orderDetails.customerInfo.phone,\r\n                address: {\r\n                  line1: orderDetails.customerInfo.address,\r\n                  city: orderDetails.customerInfo.city,\r\n                  postal_code: orderDetails.customerInfo.postcode,\r\n                  country: \"GB\",\r\n                },\r\n              },\r\n            },\r\n          },\r\n          redirect: \"if_required\",\r\n        });\r\n\r\n      if (paymentError) {\r\n        throw new Error(paymentError.message || \"Payment failed\");\r\n      }\r\n\r\n      if (paymentIntent.status === \"succeeded\") {\r\n        try {\r\n          const orderData = {\r\n            paymentIntentId: paymentIntent.id,\r\n            orderDetails: cart.map((item) => ({\r\n              item: item._id || item.id,\r\n              name: item.name,\r\n              quantity: parseInt(item.quantity, 10),\r\n              price: Number(item.selectedPrice || item.price),\r\n              size: item.size || \"regular\",\r\n              // Add modifiers if needed\r\n              modifiers: [],\r\n            })),\r\n            customer: {\r\n              name: orderDetails.customerInfo.name,\r\n              email: orderDetails.customerInfo.email.toLowerCase().trim(),\r\n              phone: orderDetails.customerInfo.phone,\r\n            },\r\n            address: {\r\n              street: orderDetails.customerInfo.address.trim(),\r\n              city: orderDetails.customerInfo.city.trim(),\r\n              postcode: orderDetails.customerInfo.postcode.toUpperCase().trim(),\r\n            },\r\n            amount: {\r\n              subtotal: totals.subtotal,\r\n              deliveryFee: totals.deliveryFee,\r\n              total: totals.total,\r\n              discount: 0,\r\n            },\r\n            paymentDetails: {\r\n              paymentIntentId: paymentIntent.id,\r\n              method: \"card\",\r\n              status: \"succeeded\",\r\n            },\r\n            deliveryTime: {\r\n              requested: new Date(orderDetails.customerInfo.deliveryTime),\r\n            },\r\n            specialInstructions:\r\n              orderDetails.customerInfo.specialInstructions || \"\",\r\n            orderStatus: {\r\n              current: \"pending\",\r\n              history: [\r\n                {\r\n                  status: \"pending\",\r\n                  timestamp: new Date(),\r\n                  note: \"Order placed\",\r\n                },\r\n              ],\r\n            },\r\n          };\r\n\r\n          const { orderId } = await paymentAPI.createOrder(orderData);\r\n          clearCart();\r\n\r\n          // Store order information\r\n          sessionStorage.setItem(\"orderId\", orderId);\r\n          sessionStorage.setItem(\"paymentIntentId\", paymentIntent.id);\r\n\r\n          // Navigate to confirmation\r\n          navigate(\"/confirmation\", {\r\n            state: {\r\n              orderId,\r\n              paymentIntentId: paymentIntent.id,\r\n            },\r\n            replace: true,\r\n          });\r\n        } catch (orderError) {\r\n          throw new Error(\r\n            `Payment successful but order creation failed: ${orderError.message}`\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Payment processing error:\", error);\r\n      setError(error.message || \"Payment processing failed\");\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const totals = validateCartAndCalculateTotals(cart);\r\n\r\n  return (\r\n    <div className=\"payment-container\">\r\n      <ProgressSteps currentStep={2} />\r\n\r\n      <div className=\"payment-header\">\r\n        <h1>Secure Payment</h1>\r\n\r\n        <div className=\"order-summary\">\r\n          <h2>Order Summary</h2>\r\n          <div className=\"items-list\">\r\n            {cart.map((item) => (\r\n              <div\r\n                key={`${item.id}-${item.size || \"regular\"}`}\r\n                className=\"order-item\"\r\n              >\r\n                <div className=\"item-info\">\r\n                  <span className=\"item-name\">{item.name}</span>\r\n                  {item.size && (\r\n                    <span className=\"item-size\">({item.size})</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"item-price\">\r\n                  <span className=\"quantity\">x{item.quantity}</span>\r\n                  <span className=\"price\">\r\n                    Â£{(item.price * item.quantity).toFixed(2)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"price-breakdown\">\r\n            <div className=\"price-row\">\r\n              <span>Subtotal</span>\r\n              <span>Â£{totals.subtotal.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"price-row\">\r\n              <span>Delivery Fee</span>\r\n              <span>Â£{totals.deliveryFee.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"price-row total\">\r\n              <span>Total to Pay</span>\r\n              <span>Â£{totals.total.toFixed(2)}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"delivery-info\">\r\n          <h3>Delivery Details</h3>\r\n          {orderDetails?.customerInfo && (\r\n            <>\r\n              <div className=\"info-row\">\r\n                <span>Name:</span>\r\n                <span>{orderDetails.customerInfo.name}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>Phone:</span>\r\n                <span>{orderDetails.customerInfo.phone}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>Address:</span>\r\n                <span>{orderDetails.customerInfo.address}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>City:</span>\r\n                <span>{orderDetails.customerInfo.city}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>Postcode:</span>\r\n                <span>{orderDetails.customerInfo.postcode}</span>\r\n              </div>\r\n              <div className=\"info-row\">\r\n                <span>Delivery Time:</span>\r\n                <span>{orderDetails.customerInfo.deliveryTime}</span>\r\n              </div>\r\n              {orderDetails.customerInfo.specialInstructions && (\r\n                <div className=\"special-instructions\">\r\n                  <h4>Special Instructions:</h4>\r\n                  <p>{orderDetails.customerInfo.specialInstructions}</p>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"payment-form\">\r\n        <div className=\"payment-element-container\">\r\n          <PaymentElement />\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"error-message\" role=\"alert\">\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <button\r\n          type=\"submit\"\r\n          className=\"payment-button\"\r\n          disabled={!stripe || isProcessing}\r\n        >\r\n          <div className=\"button-content\">\r\n            {isProcessing ? (\r\n              <>\r\n                <div\r\n                  className=\"spinner\"\r\n                  role=\"status\"\r\n                  aria-label=\"Processing payment\"\r\n                />\r\n                <span>Processing...</span>\r\n              </>\r\n            ) : (\r\n              <span>Pay Â£{totals.total.toFixed(2)}</span>\r\n            )}\r\n          </div>\r\n        </button>\r\n      </form>\r\n\r\n      <div className=\"security-info\">\r\n        <p>ðŸ”’ All payments are secure and encrypted</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PaymentPage() {\r\n  const [clientSecret, setClientSecret] = useState(\"\");\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { cart } = useCart();\r\n\r\n  const orderDetails = location.state?.orderDetails;\r\n\r\n  useEffect(() => {\r\n    const initializePayment = async () => {\r\n      try {\r\n        if (!orderDetails?.customerInfo) {\r\n          throw new Error(\"Please complete your delivery information\");\r\n        }\r\n\r\n        if (!cart?.length) {\r\n          throw new Error(\"Your cart is empty\");\r\n        }\r\n\r\n        validateCustomerInfo(orderDetails.customerInfo);\r\n        const { amountInCents } = validateCartAndCalculateTotals(cart);\r\n\r\n        console.log(\"Creating payment intent:\", {\r\n          amount: amountInCents,\r\n          customer: orderDetails.customerInfo.name,\r\n        });\r\n\r\n        const response = await paymentAPI.createPaymentIntent({\r\n          amount: amountInCents,\r\n          currency: \"gbp\",\r\n          metadata: {\r\n            customerName: orderDetails.customerInfo.name,\r\n            customerEmail: orderDetails.customerInfo.email,\r\n            integration_check: \"accept_a_payment\",\r\n          },\r\n        });\r\n\r\n        console.log(\"Payment intent response:\", {\r\n          hasClientSecret: !!response.clientSecret,\r\n          hasId: !!response.id,\r\n        });\r\n\r\n        if (!response.clientSecret) {\r\n          throw new Error(\"Failed to initialize payment\");\r\n        }\r\n\r\n        setClientSecret(response.clientSecret);\r\n      } catch (error) {\r\n        console.error(\"Payment initialization failed:\", error);\r\n        setError(error.message);\r\n        // Add a slight delay before navigation\r\n        setTimeout(() => {\r\n          navigate(\"/checkout\", {\r\n            state: { error: error.message },\r\n          });\r\n        }, 100);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    // Only initialize payment if we have order details and cart\r\n    if (orderDetails && cart?.length) {\r\n      initializePayment();\r\n    } else {\r\n      setLoading(false);\r\n      setError(\"Missing order details or empty cart\");\r\n      setTimeout(() => navigate(\"/checkout\"), 100);\r\n    }\r\n  }, [cart, orderDetails, navigate]); // Keep these dependencies\r\n\r\n  // Loading state\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading-container\" role=\"status\">\r\n        <div className=\"spinner\" />\r\n        <p>Setting up payment...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Error state\r\n  if (error) {\r\n    return (\r\n      <div className=\"error-container\" role=\"alert\">\r\n        <h2>Payment Setup Failed</h2>\r\n        <p>{error}</p>\r\n        <button onClick={() => navigate(\"/checkout\")} className=\"return-button\">\r\n          Return to Checkout\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Success state\r\n  return (\r\n    <div className=\"payment-page\">\r\n      {clientSecret && (\r\n        <Elements\r\n          stripe={stripePromise}\r\n          options={{\r\n            clientSecret,\r\n            appearance: {\r\n              theme: \"stripe\",\r\n              variables: {\r\n                colorPrimary: \"#0a5c66\",\r\n                colorBackground: \"#ffffff\",\r\n                colorText: \"#30313d\",\r\n              },\r\n            },\r\n          }}\r\n        >\r\n          <CheckoutForm\r\n            orderDetails={orderDetails}\r\n            clientSecret={clientSecret}\r\n          />\r\n        </Elements>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default PaymentPage;\r\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,SAASC,QAAQ,QAAQ,yBAAyB;AAClD,SACEC,cAAc,EACdC,SAAS,EACTC,WAAW,QACN,yBAAyB;AAChC,SAASC,UAAU,QAAQ,mBAAmB;AAC9C,SAASC,WAAW,EAAEC,WAAW,QAAQ,kBAAkB;AAC3D,SAASC,OAAO,QAAQ,2BAA2B;AACnD,OAAOC,aAAa,MAAM,kBAAkB;AAC5C,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,OAAO,cAAc;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAEtB,MAAMC,aAAa,GAAGV,UAAU,CAACW,OAAO,CAACC,GAAG,CAACC,gCAAgC,CAAC;AAE9E,MAAMC,YAAY,GAAG,GAAG;;AAExB;AACA,MAAMC,gBAAgB,GAAIC,IAAI,IAAK;EACjC,IAAI,CAACA,IAAI,EAAE,MAAM,IAAIC,KAAK,CAAC,mBAAmB,CAAC;EAE/C,MAAMC,KAAK,GAAGC,MAAM,CAACH,IAAI,CAACI,aAAa,IAAIJ,IAAI,CAACE,KAAK,CAAC;EACtD,MAAMG,QAAQ,GAAGF,MAAM,CAACH,IAAI,CAACK,QAAQ,CAAC;EAEtC,IAAIC,KAAK,CAACJ,KAAK,CAAC,IAAIA,KAAK,IAAI,CAAC,EAAE;IAC9B,MAAM,IAAID,KAAK,CAAC,2BAA2BD,IAAI,CAACO,IAAI,EAAE,CAAC;EACzD;EACA,IAAI,CAACJ,MAAM,CAACK,SAAS,CAACH,QAAQ,CAAC,IAAIA,QAAQ,IAAI,CAAC,EAAE;IAChD,MAAM,IAAIJ,KAAK,CAAC,8BAA8BD,IAAI,CAACO,IAAI,EAAE,CAAC;EAC5D;EAEA,OAAO;IAAEL,KAAK;IAAEG;EAAS,CAAC;AAC5B,CAAC;AAED,MAAMI,8BAA8B,GAAIC,IAAI,IAAK;EAC/C,IAAI,CAACC,KAAK,CAACC,OAAO,CAACF,IAAI,CAAC,IAAIA,IAAI,CAACG,MAAM,KAAK,CAAC,EAAE;IAC7C,MAAM,IAAIZ,KAAK,CAAC,0BAA0B,CAAC;EAC7C;EAEA,MAAMa,UAAU,GAAGJ,IAAI,CAACK,GAAG,CAAEf,IAAI,IAAK;IACpC,MAAM;MAAEE,KAAK;MAAEG;IAAS,CAAC,GAAGN,gBAAgB,CAACC,IAAI,CAAC;IAClD,OAAOE,KAAK,GAAGG,QAAQ;EACzB,CAAC,CAAC;EAEF,MAAMW,QAAQ,GAAGb,MAAM,CACrBW,UAAU,CAACG,MAAM,CAAC,CAACC,GAAG,EAAEC,KAAK,KAAKD,GAAG,GAAGC,KAAK,EAAE,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAC7D,CAAC;EACD,MAAMD,KAAK,GAAGhB,MAAM,CAAC,CAACa,QAAQ,GAAGlB,YAAY,EAAEsB,OAAO,CAAC,CAAC,CAAC,CAAC;EAC1D,MAAMC,aAAa,GAAGC,IAAI,CAACC,KAAK,CAACJ,KAAK,GAAG,GAAG,CAAC;EAE7C,OAAO;IACLH,QAAQ;IACRQ,WAAW,EAAE1B,YAAY;IACzBqB,KAAK;IACLE;EACF,CAAC;AACH,CAAC;AACD,MAAMI,oBAAoB,GAAIC,YAAY,IAAK;EAC7C,IAAI,CAACA,YAAY,EAAE,MAAM,IAAIzB,KAAK,CAAC,kCAAkC,CAAC;EAEtE,MAAM0B,cAAc,GAAG,CACrB,MAAM,EACN,OAAO,EACP,OAAO,EACP,SAAS,EACT,MAAM,EACN,UAAU,EACV,cAAc,CACf;EAED,MAAMC,aAAa,GAAGD,cAAc,CAACE,MAAM,CAAEC,KAAK,IAAK,CAACJ,YAAY,CAACI,KAAK,CAAC,CAAC;EAC5E,IAAIF,aAAa,CAACf,MAAM,GAAG,CAAC,EAAE;IAC5B,MAAM,IAAIZ,KAAK,CAAC,4BAA4B2B,aAAa,CAACG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;EACzE;;EAEA;EACA,MAAMC,UAAU,GAAG,4BAA4B;EAC/C,IAAI,CAACA,UAAU,CAACC,IAAI,CAACP,YAAY,CAACQ,KAAK,CAAC,EAAE;IACxC,MAAM,IAAIjC,KAAK,CAAC,sBAAsB,CAAC;EACzC;;EAEA;EACA,MAAMkC,aAAa,GAAG,6CAA6C;EACnE,IAAI,CAACA,aAAa,CAACF,IAAI,CAACP,YAAY,CAACU,QAAQ,CAACC,IAAI,CAAC,CAAC,CAAC,EAAE;IACrD,MAAM,IAAIpC,KAAK,CAAC,4BAA4B,CAAC;EAC/C;;EAEA;EACA,MAAMqC,UAAU,GAAG,mBAAmB;EACtC,IAAI,CAACA,UAAU,CAACL,IAAI,CAACP,YAAY,CAACa,KAAK,CAACC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,EAAE;IAC5D,MAAM,IAAIvC,KAAK,CAAC,6BAA6B,CAAC;EAChD;AACF,CAAC;AAED,SAASwC,YAAYA,CAAC;EAAEC,YAAY;EAAEC;AAAa,CAAC,EAAE;EAAAC,EAAA;EACpD,MAAMC,MAAM,GAAG/D,SAAS,CAAC,CAAC;EAC1B,MAAMgE,QAAQ,GAAG/D,WAAW,CAAC,CAAC;EAC9B,MAAMgE,QAAQ,GAAG9D,WAAW,CAAC,CAAC;EAC9B,MAAM;IAAEyB,IAAI;IAAEsC;EAAU,CAAC,GAAG7D,OAAO,CAAC,CAAC;EACrC,MAAM,CAAC8D,YAAY,EAAEC,eAAe,CAAC,GAAGvE,QAAQ,CAAC,KAAK,CAAC;EACvD,MAAM,CAACwE,KAAK,EAAEC,QAAQ,CAAC,GAAGzE,QAAQ,CAAC,IAAI,CAAC;EAExC,MAAM0E,YAAY,GAAG,MAAOC,KAAK,IAAK;IACpCA,KAAK,CAACC,cAAc,CAAC,CAAC;IAEtB,IAAI,CAACV,MAAM,IAAI,CAACC,QAAQ,IAAIG,YAAY,IAAI,CAACN,YAAY,EAAE;MACzD;IACF;IAEA,IAAI;MACFO,eAAe,CAAC,IAAI,CAAC;MACrBE,QAAQ,CAAC,IAAI,CAAC;MAEd,MAAMI,MAAM,GAAG/C,8BAA8B,CAACC,IAAI,CAAC;;MAEnD;MACA,MAAM;QAAEyC,KAAK,EAAEM;MAAY,CAAC,GAAG,MAAMX,QAAQ,CAACY,MAAM,CAAC,CAAC;MACtD,IAAID,WAAW,EAAE;QACf,MAAM,IAAIxD,KAAK,CAAC,8BAA8BwD,WAAW,CAACE,OAAO,EAAE,CAAC;MACtE;;MAEA;MACA,MAAM;QAAER,KAAK,EAAES,YAAY;QAAEC;MAAc,CAAC,GAC1C,MAAMhB,MAAM,CAACiB,cAAc,CAAC;QAC1BhB,QAAQ;QACRiB,aAAa,EAAE;UACbC,UAAU,EAAE,GAAGC,MAAM,CAACC,QAAQ,CAACC,MAAM,eAAe;UACpDC,mBAAmB,EAAE;YACnBC,eAAe,EAAE;cACf9D,IAAI,EAAEmC,YAAY,CAAChB,YAAY,CAACnB,IAAI;cACpC2B,KAAK,EAAEQ,YAAY,CAAChB,YAAY,CAACQ,KAAK;cACtCK,KAAK,EAAEG,YAAY,CAAChB,YAAY,CAACa,KAAK;cACtC+B,OAAO,EAAE;gBACPC,KAAK,EAAE7B,YAAY,CAAChB,YAAY,CAAC4C,OAAO;gBACxCE,IAAI,EAAE9B,YAAY,CAAChB,YAAY,CAAC8C,IAAI;gBACpCC,WAAW,EAAE/B,YAAY,CAAChB,YAAY,CAACU,QAAQ;gBAC/CsC,OAAO,EAAE;cACX;YACF;UACF;QACF,CAAC;QACDC,QAAQ,EAAE;MACZ,CAAC,CAAC;MAEJ,IAAIf,YAAY,EAAE;QAChB,MAAM,IAAI3D,KAAK,CAAC2D,YAAY,CAACD,OAAO,IAAI,gBAAgB,CAAC;MAC3D;MAEA,IAAIE,aAAa,CAACe,MAAM,KAAK,WAAW,EAAE;QACxC,IAAI;UACF,MAAMC,SAAS,GAAG;YAChBC,eAAe,EAAEjB,aAAa,CAACkB,EAAE;YACjCrC,YAAY,EAAEhC,IAAI,CAACK,GAAG,CAAEf,IAAI,KAAM;cAChCA,IAAI,EAAEA,IAAI,CAACgF,GAAG,IAAIhF,IAAI,CAAC+E,EAAE;cACzBxE,IAAI,EAAEP,IAAI,CAACO,IAAI;cACfF,QAAQ,EAAE4E,QAAQ,CAACjF,IAAI,CAACK,QAAQ,EAAE,EAAE,CAAC;cACrCH,KAAK,EAAEC,MAAM,CAACH,IAAI,CAACI,aAAa,IAAIJ,IAAI,CAACE,KAAK,CAAC;cAC/CgF,IAAI,EAAElF,IAAI,CAACkF,IAAI,IAAI,SAAS;cAC5B;cACAC,SAAS,EAAE;YACb,CAAC,CAAC,CAAC;YACHC,QAAQ,EAAE;cACR7E,IAAI,EAAEmC,YAAY,CAAChB,YAAY,CAACnB,IAAI;cACpC2B,KAAK,EAAEQ,YAAY,CAAChB,YAAY,CAACQ,KAAK,CAACmD,WAAW,CAAC,CAAC,CAAChD,IAAI,CAAC,CAAC;cAC3DE,KAAK,EAAEG,YAAY,CAAChB,YAAY,CAACa;YACnC,CAAC;YACD+B,OAAO,EAAE;cACPgB,MAAM,EAAE5C,YAAY,CAAChB,YAAY,CAAC4C,OAAO,CAACjC,IAAI,CAAC,CAAC;cAChDmC,IAAI,EAAE9B,YAAY,CAAChB,YAAY,CAAC8C,IAAI,CAACnC,IAAI,CAAC,CAAC;cAC3CD,QAAQ,EAAEM,YAAY,CAAChB,YAAY,CAACU,QAAQ,CAACmD,WAAW,CAAC,CAAC,CAAClD,IAAI,CAAC;YAClE,CAAC;YACDmD,MAAM,EAAE;cACNxE,QAAQ,EAAEwC,MAAM,CAACxC,QAAQ;cACzBQ,WAAW,EAAEgC,MAAM,CAAChC,WAAW;cAC/BL,KAAK,EAAEqC,MAAM,CAACrC,KAAK;cACnBsE,QAAQ,EAAE;YACZ,CAAC;YACDC,cAAc,EAAE;cACdZ,eAAe,EAAEjB,aAAa,CAACkB,EAAE;cACjCY,MAAM,EAAE,MAAM;cACdf,MAAM,EAAE;YACV,CAAC;YACDgB,YAAY,EAAE;cACZC,SAAS,EAAE,IAAIC,IAAI,CAACpD,YAAY,CAAChB,YAAY,CAACkE,YAAY;YAC5D,CAAC;YACDG,mBAAmB,EACjBrD,YAAY,CAAChB,YAAY,CAACqE,mBAAmB,IAAI,EAAE;YACrDC,WAAW,EAAE;cACXC,OAAO,EAAE,SAAS;cAClBC,OAAO,EAAE,CACP;gBACEtB,MAAM,EAAE,SAAS;gBACjBuB,SAAS,EAAE,IAAIL,IAAI,CAAC,CAAC;gBACrBM,IAAI,EAAE;cACR,CAAC;YAEL;UACF,CAAC;UAED,MAAM;YAAEC;UAAQ,CAAC,GAAG,MAAMhH,UAAU,CAACiH,WAAW,CAACzB,SAAS,CAAC;UAC3D7B,SAAS,CAAC,CAAC;;UAEX;UACAuD,cAAc,CAACC,OAAO,CAAC,SAAS,EAAEH,OAAO,CAAC;UAC1CE,cAAc,CAACC,OAAO,CAAC,iBAAiB,EAAE3C,aAAa,CAACkB,EAAE,CAAC;;UAE3D;UACAhC,QAAQ,CAAC,eAAe,EAAE;YACxB0D,KAAK,EAAE;cACLJ,OAAO;cACPvB,eAAe,EAAEjB,aAAa,CAACkB;YACjC,CAAC;YACDvC,OAAO,EAAE;UACX,CAAC,CAAC;QACJ,CAAC,CAAC,OAAOkE,UAAU,EAAE;UACnB,MAAM,IAAIzG,KAAK,CACb,iDAAiDyG,UAAU,CAAC/C,OAAO,EACrE,CAAC;QACH;MACF;IACF,CAAC,CAAC,OAAOR,KAAK,EAAE;MACdwD,OAAO,CAACxD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjDC,QAAQ,CAACD,KAAK,CAACQ,OAAO,IAAI,2BAA2B,CAAC;IACxD,CAAC,SAAS;MACRT,eAAe,CAAC,KAAK,CAAC;IACxB;EACF,CAAC;EAED,MAAMM,MAAM,GAAG/C,8BAA8B,CAACC,IAAI,CAAC;EAEnD,oBACEnB,OAAA;IAAKqH,SAAS,EAAC,mBAAmB;IAAAC,QAAA,gBAChCtH,OAAA,CAACH,aAAa;MAAC0H,WAAW,EAAE;IAAE;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eAEjC3H,OAAA;MAAKqH,SAAS,EAAC,gBAAgB;MAAAC,QAAA,gBAC7BtH,OAAA;QAAAsH,QAAA,EAAI;MAAc;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eAEvB3H,OAAA;QAAKqH,SAAS,EAAC,eAAe;QAAAC,QAAA,gBAC5BtH,OAAA;UAAAsH,QAAA,EAAI;QAAa;UAAAE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eACtB3H,OAAA;UAAKqH,SAAS,EAAC,YAAY;UAAAC,QAAA,EACxBnG,IAAI,CAACK,GAAG,CAAEf,IAAI,iBACbT,OAAA;YAEEqH,SAAS,EAAC,YAAY;YAAAC,QAAA,gBAEtBtH,OAAA;cAAKqH,SAAS,EAAC,WAAW;cAAAC,QAAA,gBACxBtH,OAAA;gBAAMqH,SAAS,EAAC,WAAW;gBAAAC,QAAA,EAAE7G,IAAI,CAACO;cAAI;gBAAAwG,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAO,CAAC,EAC7ClH,IAAI,CAACkF,IAAI,iBACR3F,OAAA;gBAAMqH,SAAS,EAAC,WAAW;gBAAAC,QAAA,GAAC,GAAC,EAAC7G,IAAI,CAACkF,IAAI,EAAC,GAAC;cAAA;gBAAA6B,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAChD;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CAAC,eACN3H,OAAA;cAAKqH,SAAS,EAAC,YAAY;cAAAC,QAAA,gBACzBtH,OAAA;gBAAMqH,SAAS,EAAC,UAAU;gBAAAC,QAAA,GAAC,GAAC,EAAC7G,IAAI,CAACK,QAAQ;cAAA;gBAAA0G,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAO,CAAC,eAClD3H,OAAA;gBAAMqH,SAAS,EAAC,OAAO;gBAAAC,QAAA,GAAC,MACrB,EAAC,CAAC7G,IAAI,CAACE,KAAK,GAAGF,IAAI,CAACK,QAAQ,EAAEe,OAAO,CAAC,CAAC,CAAC;cAAA;gBAAA2F,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACrC,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACJ,CAAC;UAAA,GAdD,GAAGlH,IAAI,CAAC+E,EAAE,IAAI/E,IAAI,CAACkF,IAAI,IAAI,SAAS,EAAE;YAAA6B,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAexC,CACN;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACC,CAAC,eAEN3H,OAAA;UAAKqH,SAAS,EAAC,iBAAiB;UAAAC,QAAA,gBAC9BtH,OAAA;YAAKqH,SAAS,EAAC,WAAW;YAAAC,QAAA,gBACxBtH,OAAA;cAAAsH,QAAA,EAAM;YAAQ;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACrB3H,OAAA;cAAAsH,QAAA,GAAM,MAAC,EAACrD,MAAM,CAACxC,QAAQ,CAACI,OAAO,CAAC,CAAC,CAAC;YAAA;cAAA2F,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACvC,CAAC,eACN3H,OAAA;YAAKqH,SAAS,EAAC,WAAW;YAAAC,QAAA,gBACxBtH,OAAA;cAAAsH,QAAA,EAAM;YAAY;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACzB3H,OAAA;cAAAsH,QAAA,GAAM,MAAC,EAACrD,MAAM,CAAChC,WAAW,CAACJ,OAAO,CAAC,CAAC,CAAC;YAAA;cAAA2F,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC1C,CAAC,eACN3H,OAAA;YAAKqH,SAAS,EAAC,iBAAiB;YAAAC,QAAA,gBAC9BtH,OAAA;cAAAsH,QAAA,EAAM;YAAY;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACzB3H,OAAA;cAAAsH,QAAA,GAAM,MAAC,EAACrD,MAAM,CAACrC,KAAK,CAACC,OAAO,CAAC,CAAC,CAAC;YAAA;cAAA2F,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACpC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eAEN3H,OAAA;QAAKqH,SAAS,EAAC,eAAe;QAAAC,QAAA,gBAC5BtH,OAAA;UAAAsH,QAAA,EAAI;QAAgB;UAAAE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,EACxB,CAAAxE,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAEhB,YAAY,kBACzBnC,OAAA,CAAAE,SAAA;UAAAoH,QAAA,gBACEtH,OAAA;YAAKqH,SAAS,EAAC,UAAU;YAAAC,QAAA,gBACvBtH,OAAA;cAAAsH,QAAA,EAAM;YAAK;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAClB3H,OAAA;cAAAsH,QAAA,EAAOnE,YAAY,CAAChB,YAAY,CAACnB;YAAI;cAAAwG,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC1C,CAAC,eACN3H,OAAA;YAAKqH,SAAS,EAAC,UAAU;YAAAC,QAAA,gBACvBtH,OAAA;cAAAsH,QAAA,EAAM;YAAM;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACnB3H,OAAA;cAAAsH,QAAA,EAAOnE,YAAY,CAAChB,YAAY,CAACa;YAAK;cAAAwE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC3C,CAAC,eACN3H,OAAA;YAAKqH,SAAS,EAAC,UAAU;YAAAC,QAAA,gBACvBtH,OAAA;cAAAsH,QAAA,EAAM;YAAQ;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACrB3H,OAAA;cAAAsH,QAAA,EAAOnE,YAAY,CAAChB,YAAY,CAAC4C;YAAO;cAAAyC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC7C,CAAC,eACN3H,OAAA;YAAKqH,SAAS,EAAC,UAAU;YAAAC,QAAA,gBACvBtH,OAAA;cAAAsH,QAAA,EAAM;YAAK;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAClB3H,OAAA;cAAAsH,QAAA,EAAOnE,YAAY,CAAChB,YAAY,CAAC8C;YAAI;cAAAuC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC1C,CAAC,eACN3H,OAAA;YAAKqH,SAAS,EAAC,UAAU;YAAAC,QAAA,gBACvBtH,OAAA;cAAAsH,QAAA,EAAM;YAAS;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACtB3H,OAAA;cAAAsH,QAAA,EAAOnE,YAAY,CAAChB,YAAY,CAACU;YAAQ;cAAA2E,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC9C,CAAC,eACN3H,OAAA;YAAKqH,SAAS,EAAC,UAAU;YAAAC,QAAA,gBACvBtH,OAAA;cAAAsH,QAAA,EAAM;YAAc;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAC3B3H,OAAA;cAAAsH,QAAA,EAAOnE,YAAY,CAAChB,YAAY,CAACkE;YAAY;cAAAmB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAClD,CAAC,EACLxE,YAAY,CAAChB,YAAY,CAACqE,mBAAmB,iBAC5CxG,OAAA;YAAKqH,SAAS,EAAC,sBAAsB;YAAAC,QAAA,gBACnCtH,OAAA;cAAAsH,QAAA,EAAI;YAAqB;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI,CAAC,eAC9B3H,OAAA;cAAAsH,QAAA,EAAInE,YAAY,CAAChB,YAAY,CAACqE;YAAmB;cAAAgB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACnD,CACN;QAAA,eACD,CACH;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,eAEN3H,OAAA;MAAM4H,QAAQ,EAAE9D,YAAa;MAACuD,SAAS,EAAC,cAAc;MAAAC,QAAA,gBACpDtH,OAAA;QAAKqH,SAAS,EAAC,2BAA2B;QAAAC,QAAA,eACxCtH,OAAA,CAACV,cAAc;UAAAkI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACf,CAAC,EAEL/D,KAAK,iBACJ5D,OAAA;QAAKqH,SAAS,EAAC,eAAe;QAACQ,IAAI,EAAC,OAAO;QAAAP,QAAA,EACxC1D;MAAK;QAAA4D,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CACN,eAED3H,OAAA;QACE8H,IAAI,EAAC,QAAQ;QACbT,SAAS,EAAC,gBAAgB;QAC1BU,QAAQ,EAAE,CAACzE,MAAM,IAAII,YAAa;QAAA4D,QAAA,eAElCtH,OAAA;UAAKqH,SAAS,EAAC,gBAAgB;UAAAC,QAAA,EAC5B5D,YAAY,gBACX1D,OAAA,CAAAE,SAAA;YAAAoH,QAAA,gBACEtH,OAAA;cACEqH,SAAS,EAAC,SAAS;cACnBQ,IAAI,EAAC,QAAQ;cACb,cAAW;YAAoB;cAAAL,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAChC,CAAC,eACF3H,OAAA;cAAAsH,QAAA,EAAM;YAAa;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC;UAAA,eAC1B,CAAC,gBAEH3H,OAAA;YAAAsH,QAAA,GAAM,UAAK,EAACrD,MAAM,CAACrC,KAAK,CAACC,OAAO,CAAC,CAAC,CAAC;UAAA;YAAA2F,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAO;QAC3C;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACA,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC,eAEP3H,OAAA;MAAKqH,SAAS,EAAC,eAAe;MAAAC,QAAA,eAC5BtH,OAAA;QAAAsH,QAAA,EAAG;MAAwC;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC5C,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAACtE,EAAA,CApQQH,YAAY;EAAA,QACJ3D,SAAS,EACPC,WAAW,EACXE,WAAW,EACAE,OAAO;AAAA;AAAAoI,EAAA,GAJ5B9E,YAAY;AAsQrB,SAAS+E,WAAWA,CAAA,EAAG;EAAAC,GAAA;EAAA,IAAAC,eAAA;EACrB,MAAM,CAAC/E,YAAY,EAAEgF,eAAe,CAAC,GAAGhJ,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACwE,KAAK,EAAEC,QAAQ,CAAC,GAAGzE,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACiJ,OAAO,EAAEC,UAAU,CAAC,GAAGlJ,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAMuF,QAAQ,GAAGhF,WAAW,CAAC,CAAC;EAC9B,MAAM6D,QAAQ,GAAG9D,WAAW,CAAC,CAAC;EAC9B,MAAM;IAAEyB;EAAK,CAAC,GAAGvB,OAAO,CAAC,CAAC;EAE1B,MAAMuD,YAAY,IAAAgF,eAAA,GAAGxD,QAAQ,CAACuC,KAAK,cAAAiB,eAAA,uBAAdA,eAAA,CAAgBhF,YAAY;EAEjDhE,SAAS,CAAC,MAAM;IACd,MAAMoJ,iBAAiB,GAAG,MAAAA,CAAA,KAAY;MACpC,IAAI;QACF,IAAI,EAACpF,YAAY,aAAZA,YAAY,eAAZA,YAAY,CAAEhB,YAAY,GAAE;UAC/B,MAAM,IAAIzB,KAAK,CAAC,2CAA2C,CAAC;QAC9D;QAEA,IAAI,EAACS,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEG,MAAM,GAAE;UACjB,MAAM,IAAIZ,KAAK,CAAC,oBAAoB,CAAC;QACvC;QAEAwB,oBAAoB,CAACiB,YAAY,CAAChB,YAAY,CAAC;QAC/C,MAAM;UAAEL;QAAc,CAAC,GAAGZ,8BAA8B,CAACC,IAAI,CAAC;QAE9DiG,OAAO,CAACoB,GAAG,CAAC,0BAA0B,EAAE;UACtCvC,MAAM,EAAEnE,aAAa;UACrB+D,QAAQ,EAAE1C,YAAY,CAAChB,YAAY,CAACnB;QACtC,CAAC,CAAC;QAEF,MAAMyH,QAAQ,GAAG,MAAM3I,UAAU,CAAC4I,mBAAmB,CAAC;UACpDzC,MAAM,EAAEnE,aAAa;UACrB6G,QAAQ,EAAE,KAAK;UACfC,QAAQ,EAAE;YACRC,YAAY,EAAE1F,YAAY,CAAChB,YAAY,CAACnB,IAAI;YAC5C8H,aAAa,EAAE3F,YAAY,CAAChB,YAAY,CAACQ,KAAK;YAC9CoG,iBAAiB,EAAE;UACrB;QACF,CAAC,CAAC;QAEF3B,OAAO,CAACoB,GAAG,CAAC,0BAA0B,EAAE;UACtCQ,eAAe,EAAE,CAAC,CAACP,QAAQ,CAACrF,YAAY;UACxC6F,KAAK,EAAE,CAAC,CAACR,QAAQ,CAACjD;QACpB,CAAC,CAAC;QAEF,IAAI,CAACiD,QAAQ,CAACrF,YAAY,EAAE;UAC1B,MAAM,IAAI1C,KAAK,CAAC,8BAA8B,CAAC;QACjD;QAEA0H,eAAe,CAACK,QAAQ,CAACrF,YAAY,CAAC;MACxC,CAAC,CAAC,OAAOQ,KAAK,EAAE;QACdwD,OAAO,CAACxD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;QACtDC,QAAQ,CAACD,KAAK,CAACQ,OAAO,CAAC;QACvB;QACA8E,UAAU,CAAC,MAAM;UACf1F,QAAQ,CAAC,WAAW,EAAE;YACpB0D,KAAK,EAAE;cAAEtD,KAAK,EAAEA,KAAK,CAACQ;YAAQ;UAChC,CAAC,CAAC;QACJ,CAAC,EAAE,GAAG,CAAC;MACT,CAAC,SAAS;QACRkE,UAAU,CAAC,KAAK,CAAC;MACnB;IACF,CAAC;;IAED;IACA,IAAInF,YAAY,IAAIhC,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEG,MAAM,EAAE;MAChCiH,iBAAiB,CAAC,CAAC;IACrB,CAAC,MAAM;MACLD,UAAU,CAAC,KAAK,CAAC;MACjBzE,QAAQ,CAAC,qCAAqC,CAAC;MAC/CqF,UAAU,CAAC,MAAM1F,QAAQ,CAAC,WAAW,CAAC,EAAE,GAAG,CAAC;IAC9C;EACF,CAAC,EAAE,CAACrC,IAAI,EAAEgC,YAAY,EAAEK,QAAQ,CAAC,CAAC,CAAC,CAAC;;EAEpC;EACA,IAAI6E,OAAO,EAAE;IACX,oBACErI,OAAA;MAAKqH,SAAS,EAAC,mBAAmB;MAACQ,IAAI,EAAC,QAAQ;MAAAP,QAAA,gBAC9CtH,OAAA;QAAKqH,SAAS,EAAC;MAAS;QAAAG,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eAC3B3H,OAAA;QAAAsH,QAAA,EAAG;MAAqB;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACzB,CAAC;EAEV;;EAEA;EACA,IAAI/D,KAAK,EAAE;IACT,oBACE5D,OAAA;MAAKqH,SAAS,EAAC,iBAAiB;MAACQ,IAAI,EAAC,OAAO;MAAAP,QAAA,gBAC3CtH,OAAA;QAAAsH,QAAA,EAAI;MAAoB;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eAC7B3H,OAAA;QAAAsH,QAAA,EAAI1D;MAAK;QAAA4D,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eACd3H,OAAA;QAAQmJ,OAAO,EAAEA,CAAA,KAAM3F,QAAQ,CAAC,WAAW,CAAE;QAAC6D,SAAS,EAAC,eAAe;QAAAC,QAAA,EAAC;MAExE;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CAAC;EAEV;;EAEA;EACA,oBACE3H,OAAA;IAAKqH,SAAS,EAAC,cAAc;IAAAC,QAAA,EAC1BlE,YAAY,iBACXpD,OAAA,CAACX,QAAQ;MACPiE,MAAM,EAAEnD,aAAc;MACtBiJ,OAAO,EAAE;QACPhG,YAAY;QACZiG,UAAU,EAAE;UACVC,KAAK,EAAE,QAAQ;UACfC,SAAS,EAAE;YACTC,YAAY,EAAE,SAAS;YACvBC,eAAe,EAAE,SAAS;YAC1BC,SAAS,EAAE;UACb;QACF;MACF,CAAE;MAAApC,QAAA,eAEFtH,OAAA,CAACkD,YAAY;QACXC,YAAY,EAAEA,YAAa;QAC3BC,YAAY,EAAEA;MAAa;QAAAoE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC5B;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACM;EACX;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACE,CAAC;AAEV;AAACO,GAAA,CA1HQD,WAAW;EAAA,QAIDtI,WAAW,EACXD,WAAW,EACXE,OAAO;AAAA;AAAA+J,GAAA,GANjB1B,WAAW;AA4HpB,eAAeA,WAAW;AAAC,IAAAD,EAAA,EAAA2B,GAAA;AAAAC,YAAA,CAAA5B,EAAA;AAAA4B,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}